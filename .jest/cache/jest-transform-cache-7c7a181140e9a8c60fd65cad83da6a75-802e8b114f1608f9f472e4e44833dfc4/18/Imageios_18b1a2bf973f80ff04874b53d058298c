8e794b7eb7aceef95d6e6847e7d3d7c4
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _NativeImageLoaderIOS = _interopRequireDefault(require("./NativeImageLoaderIOS"));

var DeprecatedImagePropType = require('../DeprecatedPropTypes/DeprecatedImagePropType');

var React = require('react');

var ReactNative = require('../Renderer/shims/ReactNative');

var StyleSheet = require('../StyleSheet/StyleSheet');

var flattenStyle = require('../StyleSheet/flattenStyle');

var resolveAssetSource = require('./resolveAssetSource');

var RCTImageView = require('./ImageViewNativeComponent');

function getSize(uri, success, failure) {
  _NativeImageLoaderIOS.default.getSize(uri).then(function (_ref) {
    var _ref2 = (0, _slicedToArray2.default)(_ref, 2),
        width = _ref2[0],
        height = _ref2[1];

    return success(width, height);
  }).catch(failure || function () {
    console.warn('Failed to get size for image ' + uri);
  });
}

function getSizeWithHeaders(uri, headers, success, failure) {
  return _NativeImageLoaderIOS.default.getSizeWithHeaders(uri, headers).then(function (sizes) {
    success(sizes.width, sizes.height);
  }).catch(failure || function () {
    console.warn('Failed to get size for image: ' + uri);
  });
}

function prefetch(url) {
  return _NativeImageLoaderIOS.default.prefetchImage(url);
}

function queryCache(urls) {
  return _regenerator.default.async(function queryCache$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          _context.next = 2;
          return _regenerator.default.awrap(_NativeImageLoaderIOS.default.queryCache(urls));

        case 2:
          return _context.abrupt("return", _context.sent);

        case 3:
        case "end":
          return _context.stop();
      }
    }
  }, null, null, null, Promise);
}

var Image = function Image(props, forwardedRef) {
  var source = resolveAssetSource(props.source) || {
    uri: undefined,
    width: undefined,
    height: undefined
  };
  var sources;
  var style;

  if (Array.isArray(source)) {
    style = flattenStyle([styles.base, props.style]) || {};
    sources = source;
  } else {
    var _width = source.width,
        _height = source.height,
        uri = source.uri;
    style = flattenStyle([{
      width: _width,
      height: _height
    }, styles.base, props.style]) || {};
    sources = [source];

    if (uri === '') {
      console.warn('source.uri should not be an empty string');
    }
  }

  var resizeMode = props.resizeMode || style.resizeMode || 'cover';
  var tintColor = style.tintColor;

  if (props.src != null) {
    console.warn('The <Image> component requires a `source` property rather than `src`.');
  }

  if (props.children != null) {
    throw new Error('The <Image> component cannot contain children. If you want to render content on top of the image, consider using the <ImageBackground> component or absolute positioning.');
  }

  return React.createElement(RCTImageView, (0, _extends2.default)({}, props, {
    ref: forwardedRef,
    style: style,
    resizeMode: resizeMode,
    tintColor: tintColor,
    source: sources
  }));
};

Image = React.forwardRef(Image);
Image.displayName = 'Image';
Image.getSize = getSize;
Image.getSizeWithHeaders = getSizeWithHeaders;
Image.prefetch = prefetch;
Image.queryCache = queryCache;
Image.resolveAssetSource = resolveAssetSource;
Image.propTypes = DeprecatedImagePropType;
var styles = StyleSheet.create({
  base: {
    overflow: 'hidden'
  }
});
module.exports = Image;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkltYWdlLmlvcy5qcyJdLCJuYW1lcyI6WyJEZXByZWNhdGVkSW1hZ2VQcm9wVHlwZSIsInJlcXVpcmUiLCJSZWFjdCIsIlJlYWN0TmF0aXZlIiwiU3R5bGVTaGVldCIsImZsYXR0ZW5TdHlsZSIsInJlc29sdmVBc3NldFNvdXJjZSIsIlJDVEltYWdlVmlldyIsImdldFNpemUiLCJ1cmkiLCJzdWNjZXNzIiwiZmFpbHVyZSIsIk5hdGl2ZUltYWdlTG9hZGVySU9TIiwidGhlbiIsIndpZHRoIiwiaGVpZ2h0IiwiY2F0Y2giLCJjb25zb2xlIiwid2FybiIsImdldFNpemVXaXRoSGVhZGVycyIsImhlYWRlcnMiLCJzaXplcyIsInByZWZldGNoIiwidXJsIiwicHJlZmV0Y2hJbWFnZSIsInF1ZXJ5Q2FjaGUiLCJ1cmxzIiwiSW1hZ2UiLCJwcm9wcyIsImZvcndhcmRlZFJlZiIsInNvdXJjZSIsInVuZGVmaW5lZCIsInNvdXJjZXMiLCJzdHlsZSIsIkFycmF5IiwiaXNBcnJheSIsInN0eWxlcyIsImJhc2UiLCJyZXNpemVNb2RlIiwidGludENvbG9yIiwic3JjIiwiY2hpbGRyZW4iLCJFcnJvciIsImZvcndhcmRSZWYiLCJkaXNwbGF5TmFtZSIsInByb3BUeXBlcyIsImNyZWF0ZSIsIm92ZXJmbG93IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7Ozs7Ozs7QUFhQTs7QUFYQSxJQUFNQSx1QkFBdUIsR0FBR0MsT0FBTyxDQUFDLGdEQUFELENBQXZDOztBQUNBLElBQU1DLEtBQUssR0FBR0QsT0FBTyxDQUFDLE9BQUQsQ0FBckI7O0FBQ0EsSUFBTUUsV0FBVyxHQUFHRixPQUFPLENBQUMsK0JBQUQsQ0FBM0I7O0FBQ0EsSUFBTUcsVUFBVSxHQUFHSCxPQUFPLENBQUMsMEJBQUQsQ0FBMUI7O0FBRUEsSUFBTUksWUFBWSxHQUFHSixPQUFPLENBQUMsNEJBQUQsQ0FBNUI7O0FBQ0EsSUFBTUssa0JBQWtCLEdBQUdMLE9BQU8sQ0FBQyxzQkFB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dEIsS0FBbkIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBEZXByZWNhdGVkSW1hZ2VQcm9wVHlwZSA9IHJlcXVpcmUoJy4uL0RlcHJlY2F0ZWRQcm9wVHlwZXMvRGVwcmVjYXRlZEltYWdlUHJvcFR5cGUnKTtcbmNvbnN0IFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcbmNvbnN0IFJlYWN0TmF0aXZlID0gcmVxdWlyZSgnLi4vUmVuZGVyZXIvc2hpbXMvUmVhY3ROYXRpdmUnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFyc1xuY29uc3QgU3R5bGVTaGVldCA9IHJlcXVpcmUoJy4uL1N0eWxlU2hlZXQvU3R5bGVTaGVldCcpO1xuXG5jb25zdCBmbGF0dGVuU3R5bGUgPSByZXF1aXJlKCcuLi9TdHlsZVNoZWV0L2ZsYXR0ZW5TdHlsZScpO1xuY29uc3QgcmVzb2x2ZUFzc2V0U291cmNlID0gcmVxdWlyZSgnLi9yZXNvbHZlQXNzZXRTb3VyY2UnKTtcblxuaW1wb3J0IHR5cGUge0ltYWdlUHJvcHMgYXMgSW1hZ2VQcm9wc1R5cGV9IGZyb20gJy4vSW1hZ2VQcm9wcyc7XG5cbmltcG9ydCB0eXBlIHtJbWFnZVN0eWxlUHJvcH0gZnJvbSAnLi4vU3R5bGVTaGVldC9TdHlsZVNoZWV0JztcbmltcG9ydCBOYXRpdmVJbWFnZUxvYWRlcklPUyBmcm9tICcuL05hdGl2ZUltYWdlTG9hZGVySU9TJztcblxuY29uc3QgUkNUSW1hZ2VWaWV3ID0gcmVxdWlyZSgnLi9JbWFnZVZpZXdOYXRpdmVDb21wb25lbnQnKTtcblxuZnVuY3Rpb24gZ2V0U2l6ZShcbiAgdXJpOiBzdHJpbmcsXG4gIHN1Y2Nlc3M6ICh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikgPT4gdm9pZCxcbiAgZmFpbHVyZT86IChlcnJvcjogYW55KSA9PiB2b2lkLFxuKSB7XG4gIE5hdGl2ZUltYWdlTG9hZGVySU9TLmdldFNpemUodXJpKVxuICAgIC50aGVuKChbd2lkdGgsIGhlaWdodF0pID0+IHN1Y2Nlc3Mod2lkdGgsIGhlaWdodCkpXG4gICAgLmNhdGNoKFxuICAgICAgZmFpbHVyZSB8fFxuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBnZXQgc2l6ZSBmb3IgaW1hZ2UgJyArIHVyaSk7XG4gICAgICAgIH0sXG4gICAgKTtcbn1cblxuZnVuY3Rpb24gZ2V0U2l6ZVdpdGhIZWFkZXJzKFxuICB1cmk6IHN0cmluZyxcbiAgaGVhZGVyczoge1tzdHJpbmddOiBzdHJpbmcsIC4uLn0sXG4gIHN1Y2Nlc3M6ICh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikgPT4gdm9pZCxcbiAgZmFpbHVyZT86IChlcnJvcjogYW55KSA9PiB2b2lkLFxuKTogYW55IHtcbiAgcmV0dXJuIE5hdGl2ZUltYWdlTG9hZGVySU9TLmdldFNpemVXaXRoSGVhZGVycyh1cmksIGhlYWRlcnMpXG4gICAgLnRoZW4oZnVuY3Rpb24oc2l6ZXMpIHtcbiAgICAgIHN1Y2Nlc3Moc2l6ZXMud2lkdGgsIHNpemVzLmhlaWdodCk7XG4gICAgfSlcbiAgICAuY2F0Y2goXG4gICAgICBmYWlsdXJlIHx8XG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIGdldCBzaXplIGZvciBpbWFnZTogJyArIHVyaSk7XG4gICAgICAgIH0sXG4gICAgKTtcbn1cblxuZnVuY3Rpb24gcHJlZmV0Y2godXJsOiBzdHJpbmcpOiBhbnkge1xuICByZXR1cm4gTmF0aXZlSW1hZ2VMb2FkZXJJT1MucHJlZmV0Y2hJbWFnZSh1cmwpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBxdWVyeUNhY2hlKFxuICB1cmxzOiBBcnJheTxzdHJpbmc+LFxuKTogUHJvbWlzZTx7W3N0cmluZ106ICdtZW1vcnknIHwgJ2Rpc2snIHwgJ2Rpc2svbWVtb3J5JywgLi4ufT4ge1xuICByZXR1cm4gYXdhaXQgTmF0aXZlSW1hZ2VMb2FkZXJJT1MucXVlcnlDYWNoZSh1cmxzKTtcbn1cblxudHlwZSBJbWFnZUNvbXBvbmVudFN0YXRpY3MgPSAkUmVhZE9ubHk8e3xcbiAgZ2V0U2l6ZTogdHlwZW9mIGdldFNpemUsXG4gIGdldFNpemVXaXRoSGVhZGVyczogdHlwZW9mIGdldFNpemVXaXRoSGVhZGVycyxcbiAgcHJlZmV0Y2g6IHR5cGVvZiBwcmVmZXRjaCxcbiAgcXVlcnlDYWNoZTogdHlwZW9mIHF1ZXJ5Q2FjaGUsXG4gIHJlc29sdmVBc3NldFNvdXJjZTogdHlwZW9mIHJlc29sdmVBc3NldFNvdXJjZSxcbiAgcHJvcFR5cGVzOiB0eXBlb2YgRGVwcmVjYXRlZEltYWdlUHJvcFR5cGUsXG58fT47XG5cbi8qKlxuICogQSBSZWFjdCBjb21wb25lbnQgZm9yIGRpc3BsYXlpbmcgZGlmZmVyZW50IHR5cGVzIG9mIGltYWdlcyxcbiAqIGluY2x1ZGluZyBuZXR3b3JrIGltYWdlcywgc3RhdGljIHJlc291cmNlcywgdGVtcG9yYXJ5IGxvY2FsIGltYWdlcywgYW5kXG4gKiBpbWFnZXMgZnJvbSBsb2NhbCBkaXNrLCBzdWNoIGFzIHRoZSBjYW1lcmEgcm9sbC5cbiAqXG4gKiBTZWUgaHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QtbmF0aXZlL2RvY3MvaW1hZ2UuaHRtbFxuICovXG5sZXQgSW1hZ2UgPSAocHJvcHM6IEltYWdlUHJvcHNUeXBlLCBmb3J3YXJkZWRSZWYpID0+IHtcbiAgY29uc3Qgc291cmNlID0gcmVzb2x2ZUFzc2V0U291cmNlKHByb3BzLnNvdXJjZSkgfHwge1xuICAgIHVyaTogdW5kZWZpbmVkLFxuICAgIHdpZHRoOiB1bmRlZmluZWQsXG4gICAgaGVpZ2h0OiB1bmRlZmluZWQsXG4gIH07XG5cbiAgbGV0IHNvdXJjZXM7XG4gIGxldCBzdHlsZTogSW1hZ2VTdHlsZVByb3A7XG4gIGlmIChBcnJheS5pc0FycmF5KHNvdXJjZSkpIHtcbiAgICAvLyAkRmxvd0ZpeE1lIGZsYXR0ZW5TdHlsZSBpcyBub3Qgc3Ryb25nIGVub3VnaFxuICAgIHN0eWxlID0gZmxhdHRlblN0eWxlKFtzdHlsZXMuYmFzZSwgcHJvcHMuc3R5bGVdKSB8fCB7fTtcbiAgICBzb3VyY2VzID0gc291cmNlO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IHt3aWR0aCwgaGVpZ2h0LCB1cml9ID0gc291cmNlO1xuICAgIC8vICRGbG93Rml4TWUgZmxhdHRlblN0eWxlIGlzIG5vdCBzdHJvbmcgZW5vdWdoXG4gICAgc3R5bGUgPSBmbGF0dGVuU3R5bGUoW3t3aWR0aCwgaGVpZ2h0fSwgc3R5bGVzLmJhc2UsIHByb3BzLnN0eWxlXSkgfHwge307XG4gICAgc291cmNlcyA9IFtzb3VyY2VdO1xuXG4gICAgaWYgKHVyaSA9PT0gJycpIHtcbiAgICAgIGNvbnNvbGUud2Fybignc291cmNlLnVyaSBzaG91bGQgbm90IGJlIGFuIGVtcHR5IHN0cmluZycpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHJlc2l6ZU1vZGUgPSBwcm9wcy5yZXNpemVNb2RlIHx8IHN0eWxlLnJlc2l6ZU1vZGUgfHwgJ2NvdmVyJztcbiAgY29uc3QgdGludENvbG9yID0gc3R5bGUudGludENvbG9yO1xuXG4gIGlmIChwcm9wcy5zcmMgIT0gbnVsbCkge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgICdUaGUgPEltYWdlPiBjb21wb25lbnQgcmVxdWlyZXMgYSBgc291cmNlYCBwcm9wZXJ0eSByYXRoZXIgdGhhbiBgc3JjYC4nLFxuICAgICk7XG4gIH1cblxuICBpZiAocHJvcHMuY2hpbGRyZW4gIT0gbnVsbCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdUaGUgPEltYWdlPiBjb21wb25lbnQgY2Fubm90IGNvbnRhaW4gY2hpbGRyZW4uIElmIHlvdSB3YW50IHRvIHJlbmRlciBjb250ZW50IG9uIHRvcCBvZiB0aGUgaW1hZ2UsIGNvbnNpZGVyIHVzaW5nIHRoZSA8SW1hZ2VCYWNrZ3JvdW5kPiBjb21wb25lbnQgb3IgYWJzb2x1dGUgcG9zaXRpb25pbmcuJyxcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8UkNUSW1hZ2VWaWV3XG4gICAgICB7Li4ucHJvcHN9XG4gICAgICByZWY9e2ZvcndhcmRlZFJlZn1cbiAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgIHJlc2l6ZU1vZGU9e3Jlc2l6ZU1vZGV9XG4gICAgICB0aW50Q29sb3I9e3RpbnRDb2xvcn1cbiAgICAgIHNvdXJjZT17c291cmNlc31cbiAgICAvPlxuICApO1xufTtcblxuSW1hZ2UgPSBSZWFjdC5mb3J3YXJkUmVmPEltYWdlUHJvcHNUeXBlLCBSZWFjdC5FbGVtZW50UmVmPHR5cGVvZiBSQ1RJbWFnZVZpZXc+PihcbiAgSW1hZ2UsXG4pO1xuSW1hZ2UuZGlzcGxheU5hbWUgPSAnSW1hZ2UnO1xuXG4vKipcbiAqIFJldHJpZXZlIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IChpbiBwaXhlbHMpIG9mIGFuIGltYWdlIHByaW9yIHRvIGRpc3BsYXlpbmcgaXQuXG4gKlxuICogU2VlIGh0dHBzOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0LW5hdGl2ZS9kb2NzL2ltYWdlLmh0bWwjZ2V0c2l6ZVxuICovXG4vKiAkRmxvd0ZpeE1lKD49MC44OS4wIHNpdGU9cmVhY3RfbmF0aXZlX2lvc19mYikgVGhpcyBjb21tZW50IHN1cHByZXNzZXMgYW5cbiAqIGVycm9yIGZvdW5kIHdoZW4gRmxvdyB2MC44OSB3YXMgZGVwbG95ZWQuIFRvIHNlZSB0aGUgZXJyb3IsIGRlbGV0ZSB0aGlzXG4gKiBjb21tZW50IGFuZCBydW4gRmxvdy4gKi9cbkltYWdlLmdldFNpemUgPSBnZXRTaXplO1xuXG4vKipcbiAqIFJldHJpZXZlIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IChpbiBwaXhlbHMpIG9mIGFuIGltYWdlIHByaW9yIHRvIGRpc3BsYXlpbmcgaXRcbiAqIHdpdGggdGhlIGFiaWxpdHkgdG8gcHJvdmlkZSB0aGUgaGVhZGVycyBmb3IgdGhlIHJlcXVlc3QuXG4gKlxuICogU2VlIGh0dHBzOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0LW5hdGl2ZS9kb2NzL2ltYWdlLmh0bWwjZ2V0c2l6ZXdpdGhoZWFkZXJzXG4gKi9cbi8qICRGbG93Rml4TWUoPj0wLjg5LjAgc2l0ZT1yZWFjdF9uYXRpdmVfaW9zX2ZiKSBUaGlzIGNvbW1lbnQgc3VwcHJlc3NlcyBhblxuICogZXJyb3IgZm91bmQgd2hlbiBGbG93IHYwLjg5IHdhcyBkZXBsb3llZC4gVG8gc2VlIHRoZSBlcnJvciwgZGVsZXRlIHRoaXNcbiAqIGNvbW1lbnQgYW5kIHJ1biBGbG93LiAqL1xuSW1hZ2UuZ2V0U2l6ZVdpdGhIZWFkZXJzID0gZ2V0U2l6ZVdpdGhIZWFkZXJzO1xuXG4vKipcbiAqIFByZWZldGNoZXMgYSByZW1vdGUgaW1hZ2UgZm9yIGxhdGVyIHVzZSBieSBkb3dubG9hZGluZyBpdCB0byB0aGUgZGlza1xuICogY2FjaGUuXG4gKlxuICogU2VlIGh0dHBzOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0LW5hdGl2ZS9kb2NzL2ltYWdlLmh0bWwjcHJlZmV0Y2hcbiAqL1xuLyogJEZsb3dGaXhNZSg+PTAuODkuMCBzaXRlPXJlYWN0X25hdGl2ZV9pb3NfZmIpIFRoaXMgY29tbWVudCBzdXBwcmVzc2VzIGFuXG4gKiBlcnJvciBmb3VuZCB3aGVuIEZsb3cgdjAuODkgd2FzIGRlcGxveWVkLiBUbyBzZWUgdGhlIGVycm9yLCBkZWxldGUgdGhpc1xuICogY29tbWVudCBhbmQgcnVuIEZsb3cuICovXG5JbWFnZS5wcmVmZXRjaCA9IHByZWZldGNoO1xuXG4vKipcbiAqIFBlcmZvcm1zIGNhY2hlIGludGVycm9nYXRpb24uXG4gKlxuICogIFNlZSBodHRwczovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC1uYXRpdmUvZG9jcy9pbWFnZS5odG1sI3F1ZXJ5Y2FjaGVcbiAqL1xuLyogJEZsb3dGaXhNZSg+PTAuODkuMCBzaXRlPXJlYWN0X25hdGl2ZV9pb3NfZmIpIFRoaXMgY29tbWVudCBzdXBwcmVzc2VzIGFuXG4gKiBlcnJvciBmb3VuZCB3aGVuIEZsb3cgdjAuODkgd2FzIGRlcGxveWVkLiBUbyBzZWUgdGhlIGVycm9yLCBkZWxldGUgdGhpc1xuICogY29tbWVudCBhbmQgcnVuIEZsb3cuICovXG5JbWFnZS5xdWVyeUNhY2hlID0gcXVlcnlDYWNoZTtcblxuLyoqXG4gKiBSZXNvbHZlcyBhbiBhc3NldCByZWZlcmVuY2UgaW50byBhbiBvYmplY3QuXG4gKlxuICogU2VlIGh0dHBzOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0LW5hdGl2ZS9kb2NzL2ltYWdlLmh0bWwjcmVzb2x2ZWFzc2V0c291cmNlXG4gKi9cbi8qICRGbG93Rml4TWUoPj0wLjg5LjAgc2l0ZT1yZWFjdF9uYXRpdmVfaW9zX2ZiKSBUaGlzIGNvbW1lbnQgc3VwcHJlc3NlcyBhblxuICogZXJyb3IgZm91bmQgd2hlbiBGbG93IHYwLjg5IHdhcyBkZXBsb3llZC4gVG8gc2VlIHRoZSBlcnJvciwgZGVsZXRlIHRoaXNcbiAqIGNvbW1lbnQgYW5kIHJ1biBGbG93LiAqL1xuSW1hZ2UucmVzb2x2ZUFzc2V0U291cmNlID0gcmVzb2x2ZUFzc2V0U291cmNlO1xuXG4vKiAkRmxvd0ZpeE1lKD49MC44OS4wIHNpdGU9cmVhY3RfbmF0aXZlX2lvc19mYikgVGhpcyBjb21tZW50IHN1cHByZXNzZXMgYW5cbiAqIGVycm9yIGZvdW5kIHdoZW4gRmxvdyB2MC44OSB3YXMgZGVwbG95ZWQuIFRvIHNlZSB0aGUgZXJyb3IsIGRlbGV0ZSB0aGlzXG4gKiBjb21tZW50IGFuZCBydW4gRmxvdy4gKi9cbkltYWdlLnByb3BUeXBlcyA9IERlcHJlY2F0ZWRJbWFnZVByb3BUeXBlO1xuXG5jb25zdCBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XG4gIGJhc2U6IHtcbiAgICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gIH0sXG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSAoKEltYWdlOiBhbnkpOiBSZWFjdC5BYnN0cmFjdENvbXBvbmVudDxcbiAgSW1hZ2VQcm9wc1R5cGUsXG4gIFJlYWN0LkVsZW1lbnRSZWY8dHlwZW9mIFJDVEltYWdlVmlldz4sXG4+ICZcbiAgSW1hZ2VDb21wb25lbnRTdGF0aWNzKTtcbiJdfQ==