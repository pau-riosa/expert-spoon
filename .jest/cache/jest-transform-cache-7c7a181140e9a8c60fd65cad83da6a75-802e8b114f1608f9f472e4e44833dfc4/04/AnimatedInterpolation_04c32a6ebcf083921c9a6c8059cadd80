7567263be7618a3b0ec2fc4539004293
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _get2 = _interopRequireDefault(require("@babel/runtime/helpers/get"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

function _createSuper(Derived) { return function () { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var AnimatedNode = require('./AnimatedNode');

var AnimatedWithChildren = require('./AnimatedWithChildren');

var NativeAnimatedHelper = require('../NativeAnimatedHelper');

var invariant = require('invariant');

var normalizeColor = require('../../../StyleSheet/normalizeColor');

var linear = function linear(t) {
  return t;
};

function createInterpolation(config) {
  if (config.outputRange && typeof config.outputRange[0] === 'string') {
    return createInterpolationFromStringOutputRange(config);
  }

  var outputRange = config.outputRange;
  checkInfiniteRange('outputRange', outputRange);
  var inputRange = config.inputRange;
  checkInfiniteRange('inputRange', inputRange);
  checkValidInputRange(inputRange);
  invariant(inputRange.length === outputRange.length, 'inputRange (' + inputRange.length + ') and outputRange (' + outputRange.length + ') must have the same length');
  var easing = config.easing || linear;
  var extrapolateLeft = 'extend';

  if (config.extrapolateLeft !== undefined) {
    extrapolateLeft = config.extrapolateLeft;
  } else if (config.extrapolate !== undefined) {
    extrapolateLeft = config.extrapolate;
  }

  var extrapolateRight = 'extend';

  if (config.extrapolateRight !== undefined) {
    extrapolateRight = config.extrapolateRight;
  } else if (config.extrapolate !== undefined) {
    extrapolateRight = config.extrapolate;
  }

  return function (input) {
    invariant(typeof input === 'number', 'Cannot interpolation an input which is not a number');
    var range = findRange(input, inputRange);
    return interpolate(input, inputRange[range], inputRange[range + 1], outputRange[range], outputRange[range + 1], easing, extrapolateLeft, extrapolateRight);
  };
}

function interpolate(input, inputMin, inputMax, outputMin, outputMax, easing, extrapolateLeft, extrapolateRight) {
  var result = input;

  if (result < inputMin) {
    if (extrapolateLeft === 'identity') {
      return result;
    } else if (extrapolateLeft === 'clamp') {
      result = inputMin;
    } else if (extrapolateLeft === 'extend') {}
  }

  if (result > inputMax) {
    if (extrapolateRight === 'identity') {
      return result;
    } else if (extrapolateRight === 'clamp') {
      result = inputMax;
    } else if (extrapolateRight === 'extend') {}
  }

  if (outputMin === outputMax) {
    return outputMin;
  }

  if (inputMin === inputMax) {
    if (input <= inputMin) {
      return outputMin;
    }

    return outputMax;
  }

  if (inputMin === -Infinity) {
    result = -result;
  } else if (inputMax === Infinity) {
    result = result - inputMin;
  } else {
    result = (result - inputMin) / (inputMax - inputMin);
  }

  result = easing(result);

  if (outputMin === -Infinity) {
    result = -result;
  } else if (outputMax === Infinity) {
    result = result + outputMin;
  } else {
    result = result * (outputMax - outputMin) + outputMin;
  }

  return result;
}

function colorToRgba(input) {
  var int32Color = normalizeColor(input);

  if (int32Color === null) {
    return input;
  }

  int32Color = int32Color || 0;
  var r = (int32Color & 0xff000000) >>> 24;
  var g = (int32Color & 0x00ff0000) >>> 16;
  var b = (int32Color & 0x0000ff00) >>> 8;
  var a = (int32Color & 0x000000ff) / 255;
  return "rgba(" + r + ", " + g + ", " + b + ", " + a + ")";
}

var stringShapeRegex = /[+-]?(?:\d+\.?\d*|\.\d+)(?:[eE][+-]?\d+)?/g;

function createInterpolationFromStringOutputRange(config) {
  var outputRange = config.outputRange;
  invariant(outputRange.length >= 2, 'Bad output range');
  outputRange = outputRange.map(colorToRgba);
  checkPattern(outputRange);
  var outputRanges = outputRange[0].match(stringShapeRegex).map(function () {
    return [];
  });
  outputRange.forEach(function (value) {
    value.match(stringShapeRegex).forEach(function (number, i) {
      outputRanges[i].push(+number);
    });
  });
  var interpolations = outputRange[0].match(stringShapeRegex).map(function (value, i) {
    return createInterpolation(_objectSpread({}, config, {
      outputRange: outputRanges[i]
    }));
  });
  var shouldRound = isRgbOrRgba(outputRange[0]);
  return function (input) {
    var i = 0;
    return outputRange[0].replace(stringShapeRegex, function () {
      var val = +interpolations[i++](input);

      if (shouldRound) {
        val = i < 4 ? Math.round(val) : Math.round(val * 1000) / 1000;
      }

      return String(val);
    });
  };
}

function isRgbOrRgba(range) {
  return typeof range === 'string' && range.startsWith('rgb');
}

function checkPattern(arr) {
  var pattern = arr[0].replace(stringShapeRegex, '');

  for (var i = 1; i < arr.length; ++i) {
    invariant(pattern === arr[i].replace(stringShapeRegex, ''), 'invalid pattern ' + arr[0] + ' and ' + arr[i]);
  }
}

function findRange(input, inputRange) {
  var i;

  for (i = 1; i < inputRange.length - 1; ++i) {
    if (inputRange[i] >= input) {
      break;
    }
  }

  return i - 1;
}

function checkValidInputRange(arr) {
  invariant(arr.length >= 2, 'inputRange must have at least 2 elements');

  for (var i = 1; i < arr.length; ++i) {
    invariant(arr[i] >= arr[i - 1], 'inputRange must be monotonically non-decreasing ' + arr);
  }
}

function checkInfiniteRange(name, arr) {
  invariant(arr.length >= 2, name + ' must have at least 2 elements');
  invariant(arr.length !== 2 || arr[0] !== -Infinity || arr[1] !== Infinity, name + 'cannot be ]-infinity;+infinity[ ' + arr);
}

var AnimatedInterpolation = function (_AnimatedWithChildren) {
  (0, _inherits2.default)(AnimatedInterpolation, _AnimatedWithChildren);

  var _super = _createSuper(AnimatedInterpolation);

  function AnimatedInterpolation(parent, config) {
    var _this;

    (0, _classCallCheck2.default)(this, AnimatedInterpolation);
    _this = _super.call(this);
    _this._parent = parent;
    _this._config = config;
    _this._interpolation = createInterpolation(config);
    return _this;
  }

  (0, _createClass2.default)(AnimatedInterpolation, [{
    key: "__makeNative",
    value: function __makeNative() {
      this._parent.__makeNative();

      (0, _get2.default)((0, _getPrototypeOf2.default)(AnimatedInterpolation.prototype), "__makeNative", this).call(this);
    }
  }, {
    key: "__getValue",
    value: function __getValue() {
      var parentValue = this._parent.__getValue();

      invariant(typeof parentValue === 'number', 'Cannot interpolate an input which is not a number.');
      return this._interpolation(parentValue);
    }
  }, {
    key: "interpolate",
    value: function interpolate(config) {
      return new AnimatedInterpolation(this, config);
    }
  }, {
    key: "__attach",
    value: function __attach() {
      this._parent.__addChild(this);
    }
  }, {
    key: "__detach",
    value: function __detach() {
      this._parent.__removeChild(this);

      (0, _get2.default)((0, _getPrototypeOf2.default)(AnimatedInterpolation.prototype), "__detach", this).call(this);
    }
  }, {
    key: "__transformDataType",
    value: function __transformDataType(range) {
      return range.map(NativeAnimatedHelper.transformDataType);
    }
  }, {
    key: "__getNativeConfig",
    value: function __getNativeConfig() {
      if (__DEV__) {
        NativeAnimatedHelper.validateInterpolation(this._config);
      }

      return {
        inputRange: this._config.inputRange,
        outputRange: this.__transformDataType(this._config.outputRange),
        extrapolateLeft: this._config.extrapolateLeft || this._config.extrapolate || 'extend',
        extrapolateRight: this._config.extrapolateRight || this._config.extrapolate || 'extend',
        type: 'interpolation'
      };
    }
  }]);
  return AnimatedInterpolation;
}(AnimatedWithChildren);

AnimatedInterpolation.__createInterpolation = createInterpolation;
module.exports = AnimatedInterpolation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuaW1hdGVkSW50ZXJwb2xhdGlvbi5qcyJdLCJuYW1lcyI6WyJBbmltYXRlZE5vZGUiLCJyZXF1aXJlIiwiQW5pbWF0ZWRXaXRoQ2hpbGRyZW4iLCJOYXRpdmVBbmltYXRlZEhlbHBlciIsImludmFyaWFudCIsIm5vcm1hbGl6ZUNvbG9yIiwibGluZWFyIiwidCIsImNyZWF0ZUludGVycG9sYXRpb24iLCJjb25maWciLCJvdXRwdXRSYW5nZSIsImNyZWF0ZUludGVycG9sYXRpb25Gcm9tU3RyaW5nT3V0cHV0UmFuZ2UiLCJjaGVja0luZmluaXRlUmFuZ2UiLCJpbnB1dFJhbmdlIiwiY2hlY2tWYWxpZElucHV0UmFuZ2UiLCJsZW5ndGgiLCJlYXNpbmciLCJleHRyYXBvbGF0ZUxlZnQiLCJ1bmRlZmluZWQiLCJleHRyYXBvbGF0ZSIsImV4dHJhcG9sYXRlUmlnaHQiLCJpbnB1dCIsInJhbmdlIiwiZmluZFJhbmdlIiwiaW50ZXJwb2xhdGUiLCJpbnB1dE1pbiIsImlucHV0TWF4Iiwib3V0cHV0TWluIiwib3V0cHV0TWF4IiwicmVzdWx0IiwiSW5maW5pdHkiLCJjb2xvclRvUmdiYSIsImludDMyQ29sb3IiLCJyIiwiZyIsImIiLCJhIiwic3RyaW5nU2hhcGVSZWdleCIsIm1hcCIsImNoZWNrUGF0dGVybiIsIm91dHB1dFJhbmdlcyIsIm1hdGNoIiwiZm9yRWFjaCIsInZhbHVlIiwibnVtYmVyIiwiaSIsInB1c2giLCJpbnRlcnBvbGF0aW9ucyIsInNob3VsZFJvdW5kIiwiaXNSZ2JPclJnYmEiLCJyZXBsYWNlIiwidmFsIiwiTWF0aCIsInJvdW5kIiwiU3RyaW5nIiwic3RhcnRzV2l0aCIsImFyciIsInBhdHRlcm4iLCJuYW1lIiwiQW5pbWF0ZWRJbnRlcnBvbGF0aW9uIiwicGFyZW50IiwiX3BhcmVudCIsIl9jb25maWciLCJfaW50ZXJwb2xhdGlvbiIsIl9fbWFrZU5hdGl2ZSIsInBhcmVudFZhbHVlIiwiX19nZXRWYWx1ZSIsIl9fYWRkQ2hpbGQiLCJfX3JlbW92ZUNoaWxkIiwidHJhbnNmb3JtRGF0YVR5cGUiLCJfX0RFVl9fIiwidmFsaWRhdGVJbnRlcnBvbGF0aW9uIiwiX190cmFuc2Zvcm1EYXRhVHlwZSIsInR5cGUiLCJfX2NyZWF0ZUludGVycG9sYXRpb24iLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFZQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxZQUFZLEdBQUdDLE9BQU8sQ0FBQyxnQkFBRCxDQUE1Qjs7QUFDQSxJQUFNQyxvQkFBb0IsR0FBR0QsT0FBTyxDQUFDLHdCQUFELENBQXBDOztBQUNBLElBQU1FLG9CQUFvQixHQUFHRixPQUFPLENBQUMseUJBQUQsQ0FBcEM7O0FBRUEsSUFBTUcsU0FBUyxHQUFHSCxPQUFPLENBQUMsV0FBRCxDQUF6Qjs7QUFDQSxJQUFNSSxjQUFjLEdBQUdKLE9BQU8sQ0FBQyxvQ0FBRCxDQUE5Qjs7QUFrQkEsSUFBTUssTUFBTSxHQUFHLFNBQVRBLE1BQVMsQ0FBQUMsQ0FBQztBQUFBLFNBQUlBLENBQUo7QUFBQSxDQUFoQjs7QUFNQSxTQUFTQyxtQkFBVCxDQUNFQyxNQURGLEVBRXNDO0FBQ3BDLE1BQUlBLE1BQU0sQ0FBQ0MsV0FBUCxJQUFzQixPQUFPRCxNQUFNLENBQUNDLFdBQVAsQ0FBbUIsQ0FBbkIsQ0FBUCxLQUFpQyxRQUEzRCxFQUFxRTtBQUNuRSxXQUFPQyx3Q0FBd0MsQ0FBQ0YsTUFBRCxDQUEvQztBQUNEOztBQUVELE1BQU1DLFdBQTBCLEdBQUlELE1BQU0sQ0FBQ0MsV0FBM0M7QUFDQUUsRUFBQUEsa0JBQWtCLENBQUMsYUFBRCxFQUFnQkYsV0FBaEIsQ0FBbEI7QUFFQSxNQUFNRyxVQUFVLEdBQUdKLE1BQU0sQ0FBQ0ksVUFBMUI7QUFDQUQsRUFBQUEsa0JBQWtCLENBQUMsWUFBRCxFQUFlQyxVQUFmLENBQWxCO0FBQ0FDLEVBQUFBLG9CQUFvQixDQUFDRCxVQUFELENBQXBCO0FBRUFULEVBQUFBLFNBQVMsQ0FDUFMsVUFBVSxDQUFDRSxNQUFYLEtB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QUFBLFdBQVcsRUFBRSxLQUFLOEQsbUJBQUwsQ0FBeUIsS0FBS1YsT0FBTCxDQUFhcEQsV0FBdEMsQ0FIUjtBQUlMTyxRQUFBQSxlQUFlLEVBQ2IsS0FBSzZDLE9BQUwsQ0FBYTdDLGVBQWIsSUFBZ0MsS0FBSzZDLE9BQUwsQ0FBYTNDLFdBQTdDLElBQTRELFFBTHpEO0FBTUxDLFFBQUFBLGdCQUFnQixFQUNkLEtBQUswQyxPQUFMLENBQWExQyxnQkFBYixJQUFpQyxLQUFLMEMsT0FBTCxDQUFhM0MsV0FBOUMsSUFBNkQsUUFQMUQ7QUFRTHNELFFBQUFBLElBQUksRUFBRTtBQVJELE9BQVA7QUFVRDs7O0VBL0RpQ3ZFLG9COztBQUE5QnlELHFCLENBRUdlLHFCLEdBRW1DbEUsbUI7QUE4RDVDbUUsTUFBTSxDQUFDQyxPQUFQLEdBQWlCakIscUJBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG5cbi8qIGVzbGludCBuby1iaXR3aXNlOiAwICovXG5cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgQW5pbWF0ZWROb2RlID0gcmVxdWlyZSgnLi9BbmltYXRlZE5vZGUnKTtcbmNvbnN0IEFuaW1hdGVkV2l0aENoaWxkcmVuID0gcmVxdWlyZSgnLi9BbmltYXRlZFdpdGhDaGlsZHJlbicpO1xuY29uc3QgTmF0aXZlQW5pbWF0ZWRIZWxwZXIgPSByZXF1aXJlKCcuLi9OYXRpdmVBbmltYXRlZEhlbHBlcicpO1xuXG5jb25zdCBpbnZhcmlhbnQgPSByZXF1aXJlKCdpbnZhcmlhbnQnKTtcbmNvbnN0IG5vcm1hbGl6ZUNvbG9yID0gcmVxdWlyZSgnLi4vLi4vLi4vU3R5bGVTaGVldC9ub3JtYWxpemVDb2xvcicpO1xuXG50eXBlIEV4dHJhcG9sYXRlVHlwZSA9ICdleHRlbmQnIHwgJ2lkZW50aXR5JyB8ICdjbGFtcCc7XG5cbmV4cG9ydCB0eXBlIEludGVycG9sYXRpb25Db25maWdUeXBlID0ge1xuICBpbnB1dFJhbmdlOiBBcnJheTxudW1iZXI+LFxuICAvKiAkRmxvd0ZpeE1lKD49MC4zOC4wIHNpdGU9cmVhY3RfbmF0aXZlX2ZiLHJlYWN0X25hdGl2ZV9vc3MpIC0gRmxvdyBlcnJvclxuICAgKiBkZXRlY3RlZCBkdXJpbmcgdGhlIGRlcGxveW1lbnQgb2YgdjAuMzguMC4gVG8gc2VlIHRoZSBlcnJvciwgcmVtb3ZlIHRoaXNcbiAgICogY29tbWVudCBhbmQgcnVuIGZsb3dcbiAgICovXG4gIG91dHB1dFJhbmdlOiBBcnJheTxudW1iZXI+IHwgQXJyYXk8c3RyaW5nPixcbiAgZWFzaW5nPzogKGlucHV0OiBudW1iZXIpID0+IG51bWJlcixcbiAgZXh0cmFwb2xhdGU/OiBFeHRyYXBvbGF0ZVR5cGUsXG4gIGV4dHJhcG9sYXRlTGVmdD86IEV4dHJhcG9sYXRlVHlwZSxcbiAgZXh0cmFwb2xhdGVSaWdodD86IEV4dHJhcG9sYXRlVHlwZSxcbiAgLi4uXG59O1xuXG5jb25zdCBsaW5lYXIgPSB0ID0+IHQ7XG5cbi8qKlxuICogVmVyeSBoYW5keSBoZWxwZXIgdG8gbWFwIGlucHV0IHJhbmdlcyB0byBvdXRwdXQgcmFuZ2VzIHdpdGggYW4gZWFzaW5nXG4gKiBmdW5jdGlvbiBhbmQgY3VzdG9tIGJlaGF2aW9yIG91dHNpZGUgb2YgdGhlIHJhbmdlcy5cbiAqL1xuZnVuY3Rpb24gY3JlYXRlSW50ZXJwb2xhdGlvbihcbiAgY29uZmlnOiBJbnRlcnBvbGF0aW9uQ29uZmlnVHlwZSxcbik6IChpbnB1dDogbnVtYmVyKSA9PiBudW1iZXIgfCBzdHJpbmcge1xuICBpZiAoY29uZmlnLm91dHB1dFJhbmdlICYmIHR5cGVvZiBjb25maWcub3V0cHV0UmFuZ2VbMF0gPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGNyZWF0ZUludGVycG9sYXRpb25Gcm9tU3RyaW5nT3V0cHV0UmFuZ2UoY29uZmlnKTtcbiAgfVxuXG4gIGNvbnN0IG91dHB1dFJhbmdlOiBBcnJheTxudW1iZXI+ID0gKGNvbmZpZy5vdXRwdXRSYW5nZTogYW55KTtcbiAgY2hlY2tJbmZpbml0ZVJhbmdlKCdvdXRwdXRSYW5nZScsIG91dHB1dFJhbmdlKTtcblxuICBjb25zdCBpbnB1dFJhbmdlID0gY29uZmlnLmlucHV0UmFuZ2U7XG4gIGNoZWNrSW5maW5pdGVSYW5nZSgnaW5wdXRSYW5nZScsIGlucHV0UmFuZ2UpO1xuICBjaGVja1ZhbGlkSW5wdXRSYW5nZShpbnB1dFJhbmdlKTtcblxuICBpbnZhcmlhbnQoXG4gICAgaW5wdXRSYW5nZS5sZW5ndGggPT09IG91dHB1dFJhbmdlLmxlbmd0aCxcbiAgICAnaW5wdXRSYW5nZSAoJyArXG4gICAgICBpbnB1dFJhbmdlLmxlbmd0aCArXG4gICAgICAnKSBhbmQgb3V0cHV0UmFuZ2UgKCcgK1xuICAgICAgb3V0cHV0UmFuZ2UubGVuZ3RoICtcbiAgICAgICcpIG11c3QgaGF2ZSB0aGUgc2FtZSBsZW5ndGgnLFxuICApO1xuXG4gIGNvbnN0IGVhc2luZyA9IGNvbmZpZy5lYXNpbmcgfHwgbGluZWFyO1xuXG4gIGxldCBleHRyYXBvbGF0ZUxlZnQ6IEV4dHJhcG9sYXRlVHlwZSA9ICdleHRlbmQnO1xuICBpZiAoY29uZmlnLmV4dHJhcG9sYXRlTGVmdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgZXh0cmFwb2xhdGVMZWZ0ID0gY29uZmlnLmV4dHJhcG9sYXRlTGVmdDtcbiAgfSBlbHNlIGlmIChjb25maWcuZXh0cmFwb2xhdGUgIT09IHVuZGVmaW5lZCkge1xuICAgIGV4dHJhcG9sYXRlTGVmdCA9IGNvbmZpZy5leHRyYXBvbGF0ZTtcbiAgfVxuXG4gIGxldCBleHRyYXBvbGF0ZVJpZ2h0OiBFeHRyYXBvbGF0ZVR5cGUgPSAnZXh0ZW5kJztcbiAgaWYgKGNvbmZpZy5leHRyYXBvbGF0ZVJpZ2h0ICE9PSB1bmRlZmluZWQpIHtcbiAgICBleHRyYXBvbGF0ZVJpZ2h0ID0gY29uZmlnLmV4dHJhcG9sYXRlUmlnaHQ7XG4gIH0gZWxzZSBpZiAoY29uZmlnLmV4dHJhcG9sYXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICBleHRyYXBvbGF0ZVJpZ2h0ID0gY29uZmlnLmV4dHJhcG9sYXRlO1xuICB9XG5cbiAgcmV0dXJuIGlucHV0ID0+IHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICB0eXBlb2YgaW5wdXQgPT09ICdudW1iZXInLFxuICAgICAgJ0Nhbm5vdCBpbnRlcnBvbGF0aW9uIGFuIGlucHV0IHdoaWNoIGlzIG5vdCBhIG51bWJlcicsXG4gICAgKTtcblxuICAgIGNvbnN0IHJhbmdlID0gZmluZFJhbmdlKGlucHV0LCBpbnB1dFJhbmdlKTtcbiAgICByZXR1cm4gaW50ZXJwb2xhdGUoXG4gICAgICBpbnB1dCxcbiAgICAgIGlucHV0UmFuZ2VbcmFuZ2VdLFxuICAgICAgaW5wdXRSYW5nZVtyYW5nZSArIDFdLFxuICAgICAgb3V0cHV0UmFuZ2VbcmFuZ2VdLFxuICAgICAgb3V0cHV0UmFuZ2VbcmFuZ2UgKyAxXSxcbiAgICAgIGVhc2luZyxcbiAgICAgIGV4dHJhcG9sYXRlTGVmdCxcbiAgICAgIGV4dHJhcG9sYXRlUmlnaHQsXG4gICAgKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gaW50ZXJwb2xhdGUoXG4gIGlucHV0OiBudW1iZXIsXG4gIGlucHV0TWluOiBudW1iZXIsXG4gIGlucHV0TWF4OiBudW1iZXIsXG4gIG91dHB1dE1pbjogbnVtYmVyLFxuICBvdXRwdXRNYXg6IG51bWJlcixcbiAgZWFzaW5nOiAoaW5wdXQ6IG51bWJlcikgPT4gbnVtYmVyLFxuICBleHRyYXBvbGF0ZUxlZnQ6IEV4dHJhcG9sYXRlVHlwZSxcbiAgZXh0cmFwb2xhdGVSaWdodDogRXh0cmFwb2xhdGVUeXBlLFxuKSB7XG4gIGxldCByZXN1bHQgPSBpbnB1dDtcblxuICAvLyBFeHRyYXBvbGF0ZVxuICBpZiAocmVzdWx0IDwgaW5wdXRNaW4pIHtcbiAgICBpZiAoZXh0cmFwb2xhdGVMZWZ0ID09PSAnaWRlbnRpdHknKSB7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gZWxzZSBpZiAoZXh0cmFwb2xhdGVMZWZ0ID09PSAnY2xhbXAnKSB7XG4gICAgICByZXN1bHQgPSBpbnB1dE1pbjtcbiAgICB9IGVsc2UgaWYgKGV4dHJhcG9sYXRlTGVmdCA9PT0gJ2V4dGVuZCcpIHtcbiAgICAgIC8vIG5vb3BcbiAgICB9XG4gIH1cblxuICBpZiAocmVzdWx0ID4gaW5wdXRNYXgpIHtcbiAgICBpZiAoZXh0cmFwb2xhdGVSaWdodCA9PT0gJ2lkZW50aXR5Jykge1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGVsc2UgaWYgKGV4dHJhcG9sYXRlUmlnaHQgPT09ICdjbGFtcCcpIHtcbiAgICAgIHJlc3VsdCA9IGlucHV0TWF4O1xuICAgIH0gZWxzZSBpZiAoZXh0cmFwb2xhdGVSaWdodCA9PT0gJ2V4dGVuZCcpIHtcbiAgICAgIC8vIG5vb3BcbiAgICB9XG4gIH1cblxuICBpZiAob3V0cHV0TWluID09PSBvdXRwdXRNYXgpIHtcbiAgICByZXR1cm4gb3V0cHV0TWluO1xuICB9XG5cbiAgaWYgKGlucHV0TWluID09PSBpbnB1dE1heCkge1xuICAgIGlmIChpbnB1dCA8PSBpbnB1dE1pbikge1xuICAgICAgcmV0dXJuIG91dHB1dE1pbjtcbiAgICB9XG4gICAgcmV0dXJuIG91dHB1dE1heDtcbiAgfVxuXG4gIC8vIElucHV0IFJhbmdlXG4gIGlmIChpbnB1dE1pbiA9PT0gLUluZmluaXR5KSB7XG4gICAgcmVzdWx0ID0gLXJlc3VsdDtcbiAgfSBlbHNlIGlmIChpbnB1dE1heCA9PT0gSW5maW5pdHkpIHtcbiAgICByZXN1bHQgPSByZXN1bHQgLSBpbnB1dE1pbjtcbiAgfSBlbHNlIHtcbiAgICByZXN1bHQgPSAocmVzdWx0IC0gaW5wdXRNaW4pIC8gKGlucHV0TWF4IC0gaW5wdXRNaW4pO1xuICB9XG5cbiAgLy8gRWFzaW5nXG4gIHJlc3VsdCA9IGVhc2luZyhyZXN1bHQpO1xuXG4gIC8vIE91dHB1dCBSYW5nZVxuICBpZiAob3V0cHV0TWluID09PSAtSW5maW5pdHkpIHtcbiAgICByZXN1bHQgPSAtcmVzdWx0O1xuICB9IGVsc2UgaWYgKG91dHB1dE1heCA9PT0gSW5maW5pdHkpIHtcbiAgICByZXN1bHQgPSByZXN1bHQgKyBvdXRwdXRNaW47XG4gIH0gZWxzZSB7XG4gICAgcmVzdWx0ID0gcmVzdWx0ICogKG91dHB1dE1heCAtIG91dHB1dE1pbikgKyBvdXRwdXRNaW47XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBjb2xvclRvUmdiYShpbnB1dDogc3RyaW5nKTogc3RyaW5nIHtcbiAgbGV0IGludDMyQ29sb3IgPSBub3JtYWxpemVDb2xvcihpbnB1dCk7XG4gIGlmIChpbnQzMkNvbG9yID09PSBudWxsKSB7XG4gICAgcmV0dXJuIGlucHV0O1xuICB9XG5cbiAgaW50MzJDb2xvciA9IGludDMyQ29sb3IgfHwgMDtcblxuICBjb25zdCByID0gKGludDMyQ29sb3IgJiAweGZmMDAwMDAwKSA+Pj4gMjQ7XG4gIGNvbnN0IGcgPSAoaW50MzJDb2xvciAmIDB4MDBmZjAwMDApID4+PiAxNjtcbiAgY29uc3QgYiA9IChpbnQzMkNvbG9yICYgMHgwMDAwZmYwMCkgPj4+IDg7XG4gIGNvbnN0IGEgPSAoaW50MzJDb2xvciAmIDB4MDAwMDAwZmYpIC8gMjU1O1xuXG4gIHJldHVybiBgcmdiYSgke3J9LCAke2d9LCAke2J9LCAke2F9KWA7XG59XG5cbmNvbnN0IHN0cmluZ1NoYXBlUmVnZXggPSAvWystXT8oPzpcXGQrXFwuP1xcZCp8XFwuXFxkKykoPzpbZUVdWystXT9cXGQrKT8vZztcblxuLyoqXG4gKiBTdXBwb3J0cyBzdHJpbmcgc2hhcGVzIGJ5IGV4dHJhY3RpbmcgbnVtYmVycyBzbyBuZXcgdmFsdWVzIGNhbiBiZSBjb21wdXRlZCxcbiAqIGFuZCByZWNvbWJpbmVzIHRob3NlIHZhbHVlcyBpbnRvIG5ldyBzdHJpbmdzIG9mIHRoZSBzYW1lIHNoYXBlLiAgU3VwcG9ydHNcbiAqIHRoaW5ncyBsaWtlOlxuICpcbiAqICAgcmdiYSgxMjMsIDQyLCA5OSwgMC4zNikgLy8gY29sb3JzXG4gKiAgIC00NWRlZyAgICAgICAgICAgICAgICAgIC8vIHZhbHVlcyB3aXRoIHVuaXRzXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZUludGVycG9sYXRpb25Gcm9tU3RyaW5nT3V0cHV0UmFuZ2UoXG4gIGNvbmZpZzogSW50ZXJwb2xhdGlvbkNvbmZpZ1R5cGUsXG4pOiAoaW5wdXQ6IG51bWJlcikgPT4gc3RyaW5nIHtcbiAgbGV0IG91dHB1dFJhbmdlOiBBcnJheTxzdHJpbmc+ID0gKGNvbmZpZy5vdXRwdXRSYW5nZTogYW55KTtcbiAgaW52YXJpYW50KG91dHB1dFJhbmdlLmxlbmd0aCA+PSAyLCAnQmFkIG91dHB1dCByYW5nZScpO1xuICBvdXRwdXRSYW5nZSA9IG91dHB1dFJhbmdlLm1hcChjb2xvclRvUmdiYSk7XG4gIGNoZWNrUGF0dGVybihvdXRwdXRSYW5nZSk7XG5cbiAgLy8gWydyZ2JhKDAsIDEwMCwgMjAwLCAwKScsICdyZ2JhKDUwLCAxNTAsIDI1MCwgMC41KSddXG4gIC8vIC0+XG4gIC8vIFtcbiAgLy8gICBbMCwgNTBdLFxuICAvLyAgIFsxMDAsIDE1MF0sXG4gIC8vICAgWzIwMCwgMjUwXSxcbiAgLy8gICBbMCwgMC41XSxcbiAgLy8gXVxuICAvKiAkRmxvd0ZpeE1lKD49MC4xOC4wKTogYG91dHB1dFJhbmdlWzBdLm1hdGNoKClgIGNhbiByZXR1cm4gYG51bGxgLiBOZWVkIHRvXG4gICAqIGd1YXJkIGFnYWluc3QgdGhpcyBwb3NzaWJpbGl0eS5cbiAgICovXG4gIGNvbnN0IG91dHB1dFJhbmdlcyA9IG91dHB1dFJhbmdlWzBdLm1hdGNoKHN0cmluZ1NoYXBlUmVnZXgpLm1hcCgoKSA9PiBbXSk7XG4gIG91dHB1dFJhbmdlLmZvckVhY2godmFsdWUgPT4ge1xuICAgIC8qICRGbG93Rml4TWUoPj0wLjE4LjApOiBgdmFsdWUubWF0Y2goKWAgY2FuIHJldHVybiBgbnVsbGAuIE5lZWQgdG8gZ3VhcmRcbiAgICAgKiBhZ2FpbnN0IHRoaXMgcG9zc2liaWxpdHkuXG4gICAgICovXG4gICAgdmFsdWUubWF0Y2goc3RyaW5nU2hhcGVSZWdleCkuZm9yRWFjaCgobnVtYmVyLCBpKSA9PiB7XG4gICAgICBvdXRwdXRSYW5nZXNbaV0ucHVzaCgrbnVtYmVyKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLyogJEZsb3dGaXhNZSg+PTAuMTguMCk6IGBvdXRwdXRSYW5nZVswXS5tYXRjaCgpYCBjYW4gcmV0dXJuIGBudWxsYC4gTmVlZCB0b1xuICAgKiBndWFyZCBhZ2FpbnN0IHRoaXMgcG9zc2liaWxpdHkuXG4gICAqL1xuICBjb25zdCBpbnRlcnBvbGF0aW9ucyA9IG91dHB1dFJhbmdlWzBdXG4gICAgLm1hdGNoKHN0cmluZ1NoYXBlUmVnZXgpXG4gICAgLm1hcCgodmFsdWUsIGkpID0+IHtcbiAgICAgIHJldHVybiBjcmVhdGVJbnRlcnBvbGF0aW9uKHtcbiAgICAgICAgLi4uY29uZmlnLFxuICAgICAgICBvdXRwdXRSYW5nZTogb3V0cHV0UmFuZ2VzW2ldLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgLy8gcmdiYSByZXF1aXJlcyB0aGF0IHRoZSByLGcsYiBhcmUgaW50ZWdlcnMuLi4uIHNvIHdlIHdhbnQgdG8gcm91bmQgdGhlbSwgYnV0IHdlICpkb250KiB3YW50IHRvXG4gIC8vIHJvdW5kIHRoZSBvcGFjaXR5ICg0dGggY29sdW1uKS5cbiAgY29uc3Qgc2hvdWxkUm91bmQgPSBpc1JnYk9yUmdiYShvdXRwdXRSYW5nZVswXSk7XG5cbiAgcmV0dXJuIGlucHV0ID0+IHtcbiAgICBsZXQgaSA9IDA7XG4gICAgLy8gJ3JnYmEoMCwgMTAwLCAyMDAsIDApJ1xuICAgIC8vIC0+XG4gICAgLy8gJ3JnYmEoJHtpbnRlcnBvbGF0aW9uc1swXShpbnB1dCl9LCAke2ludGVycG9sYXRpb25zWzFdKGlucHV0KX0sIC4uLidcbiAgICByZXR1cm4gb3V0cHV0UmFuZ2VbMF0ucmVwbGFjZShzdHJpbmdTaGFwZVJlZ2V4LCAoKSA9PiB7XG4gICAgICBsZXQgdmFsID0gK2ludGVycG9sYXRpb25zW2krK10oaW5wdXQpO1xuICAgICAgaWYgKHNob3VsZFJvdW5kKSB7XG4gICAgICAgIHZhbCA9IGkgPCA0ID8gTWF0aC5yb3VuZCh2YWwpIDogTWF0aC5yb3VuZCh2YWwgKiAxMDAwKSAvIDEwMDA7XG4gICAgICB9XG4gICAgICByZXR1cm4gU3RyaW5nKHZhbCk7XG4gICAgfSk7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGlzUmdiT3JSZ2JhKHJhbmdlKSB7XG4gIHJldHVybiB0eXBlb2YgcmFuZ2UgPT09ICdzdHJpbmcnICYmIHJhbmdlLnN0YXJ0c1dpdGgoJ3JnYicpO1xufVxuXG5mdW5jdGlvbiBjaGVja1BhdHRlcm4oYXJyOiBBcnJheTxzdHJpbmc+KSB7XG4gIGNvbnN0IHBhdHRlcm4gPSBhcnJbMF0ucmVwbGFjZShzdHJpbmdTaGFwZVJlZ2V4LCAnJyk7XG4gIGZvciAobGV0IGkgPSAxOyBpIDwgYXJyLmxlbmd0aDsgKytpKSB7XG4gICAgaW52YXJpYW50KFxuICAgICAgcGF0dGVybiA9PT0gYXJyW2ldLnJlcGxhY2Uoc3RyaW5nU2hhcGVSZWdleCwgJycpLFxuICAgICAgJ2ludmFsaWQgcGF0dGVybiAnICsgYXJyWzBdICsgJyBhbmQgJyArIGFycltpXSxcbiAgICApO1xuICB9XG59XG5cbmZ1bmN0aW9uIGZpbmRSYW5nZShpbnB1dDogbnVtYmVyLCBpbnB1dFJhbmdlOiBBcnJheTxudW1iZXI+KSB7XG4gIGxldCBpO1xuICBmb3IgKGkgPSAxOyBpIDwgaW5wdXRSYW5nZS5sZW5ndGggLSAxOyArK2kpIHtcbiAgICBpZiAoaW5wdXRSYW5nZVtpXSA+PSBpbnB1dCkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIHJldHVybiBpIC0gMTtcbn1cblxuZnVuY3Rpb24gY2hlY2tWYWxpZElucHV0UmFuZ2UoYXJyOiBBcnJheTxudW1iZXI+KSB7XG4gIGludmFyaWFudChhcnIubGVuZ3RoID49IDIsICdpbnB1dFJhbmdlIG11c3QgaGF2ZSBhdCBsZWFzdCAyIGVsZW1lbnRzJyk7XG4gIGZvciAobGV0IGkgPSAxOyBpIDwgYXJyLmxlbmd0aDsgKytpKSB7XG4gICAgaW52YXJpYW50KFxuICAgICAgYXJyW2ldID49IGFycltpIC0gMV0sXG4gICAgICAvKiAkRmxvd0ZpeE1lKD49MC4xMy4wKSAtIEluIHRoZSBhZGRpdGlvbiBleHByZXNzaW9uIGJlbG93IHRoaXMgY29tbWVudCxcbiAgICAgICAqIG9uZSBvciBib3RoIG9mIHRoZSBvcGVyYW5kcyBtYXkgYmUgc29tZXRoaW5nIHRoYXQgZG9lc24ndCBjbGVhbmx5XG4gICAgICAgKiBjb252ZXJ0IHRvIGEgc3RyaW5nLCBsaWtlIHVuZGVmaW5lZCwgbnVsbCwgYW5kIG9iamVjdCwgZXRjLiBJZiB5b3UgcmVhbGx5XG4gICAgICAgKiBtZWFuIHRoaXMgaW1wbGljaXQgc3RyaW5nIGNvbnZlcnNpb24sIHlvdSBjYW4gZG8gc29tZXRoaW5nIGxpa2VcbiAgICAgICAqIFN0cmluZyhteVRoaW5nKVxuICAgICAgICovXG4gICAgICAnaW5wdXRSYW5nZSBtdXN0IGJlIG1vbm90b25pY2FsbHkgbm9uLWRlY3JlYXNpbmcgJyArIGFycixcbiAgICApO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNoZWNrSW5maW5pdGVSYW5nZShuYW1lOiBzdHJpbmcsIGFycjogQXJyYXk8bnVtYmVyPikge1xuICBpbnZhcmlhbnQoYXJyLmxlbmd0aCA+PSAyLCBuYW1lICsgJyBtdXN0IGhhdmUgYXQgbGVhc3QgMiBlbGVtZW50cycpO1xuICBpbnZhcmlhbnQoXG4gICAgYXJyLmxlbmd0aCAhPT0gMiB8fCBhcnJbMF0gIT09IC1JbmZpbml0eSB8fCBhcnJbMV0gIT09IEluZmluaXR5LFxuICAgIC8qICRGbG93Rml4TWUoPj0wLjEzLjApIC0gSW4gdGhlIGFkZGl0aW9uIGV4cHJlc3Npb24gYmVsb3cgdGhpcyBjb21tZW50LFxuICAgICAqIG9uZSBvciBib3RoIG9mIHRoZSBvcGVyYW5kcyBtYXkgYmUgc29tZXRoaW5nIHRoYXQgZG9lc24ndCBjbGVhbmx5IGNvbnZlcnRcbiAgICAgKiB0byBhIHN0cmluZywgbGlrZSB1bmRlZmluZWQsIG51bGwsIGFuZCBvYmplY3QsIGV0Yy4gSWYgeW91IHJlYWxseSBtZWFuXG4gICAgICogdGhpcyBpbXBsaWNpdCBzdHJpbmcgY29udmVyc2lvbiwgeW91IGNhbiBkbyBzb21ldGhpbmcgbGlrZVxuICAgICAqIFN0cmluZyhteVRoaW5nKVxuICAgICAqL1xuICAgIG5hbWUgKyAnY2Fubm90IGJlIF0taW5maW5pdHk7K2luZmluaXR5WyAnICsgYXJyLFxuICApO1xufVxuXG5jbGFzcyBBbmltYXRlZEludGVycG9sYXRpb24gZXh0ZW5kcyBBbmltYXRlZFdpdGhDaGlsZHJlbiB7XG4gIC8vIEV4cG9ydCBmb3IgdGVzdGluZy5cbiAgc3RhdGljIF9fY3JlYXRlSW50ZXJwb2xhdGlvbjogKFxuICAgIGNvbmZpZzogSW50ZXJwb2xhdGlvbkNvbmZpZ1R5cGUsXG4gICkgPT4gKGlucHV0OiBudW1iZXIpID0+IG51bWJlciB8IHN0cmluZyA9IGNyZWF0ZUludGVycG9sYXRpb247XG5cbiAgX3BhcmVudDogQW5pbWF0ZWROb2RlO1xuICBfY29uZmlnOiBJbnRlcnBvbGF0aW9uQ29uZmlnVHlwZTtcbiAgX2ludGVycG9sYXRpb246IChpbnB1dDogbnVtYmVyKSA9PiBudW1iZXIgfCBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IocGFyZW50OiBBbmltYXRlZE5vZGUsIGNvbmZpZzogSW50ZXJwb2xhdGlvbkNvbmZpZ1R5cGUpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX3BhcmVudCA9IHBhcmVudDtcbiAgICB0aGlzLl9jb25maWcgPSBjb25maWc7XG4gICAgdGhpcy5faW50ZXJwb2xhdGlvbiA9IGNyZWF0ZUludGVycG9sYXRpb24oY29uZmlnKTtcbiAgfVxuXG4gIF9fbWFrZU5hdGl2ZSgpIHtcbiAgICB0aGlzLl9wYXJlbnQuX19tYWtlTmF0aXZlKCk7XG4gICAgc3VwZXIuX19tYWtlTmF0aXZlKCk7XG4gIH1cblxuICBfX2dldFZhbHVlKCk6IG51bWJlciB8IHN0cmluZyB7XG4gICAgY29uc3QgcGFyZW50VmFsdWU6IG51bWJlciA9IHRoaXMuX3BhcmVudC5fX2dldFZhbHVlKCk7XG4gICAgaW52YXJpYW50KFxuICAgICAgdHlwZW9mIHBhcmVudFZhbHVlID09PSAnbnVtYmVyJyxcbiAgICAgICdDYW5ub3QgaW50ZXJwb2xhdGUgYW4gaW5wdXQgd2hpY2ggaXMgbm90IGEgbnVtYmVyLicsXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5faW50ZXJwb2xhdGlvbihwYXJlbnRWYWx1ZSk7XG4gIH1cblxuICBpbnRlcnBvbGF0ZShjb25maWc6IEludGVycG9sYXRpb25Db25maWdUeXBlKTogQW5pbWF0ZWRJbnRlcnBvbGF0aW9uIHtcbiAgICByZXR1cm4gbmV3IEFuaW1hdGVkSW50ZXJwb2xhdGlvbih0aGlzLCBjb25maWcpO1xuICB9XG5cbiAgX19hdHRhY2goKTogdm9pZCB7XG4gICAgdGhpcy5fcGFyZW50Ll9fYWRkQ2hpbGQodGhpcyk7XG4gIH1cblxuICBfX2RldGFjaCgpOiB2b2lkIHtcbiAgICB0aGlzLl9wYXJlbnQuX19yZW1vdmVDaGlsZCh0aGlzKTtcbiAgICBzdXBlci5fX2RldGFjaCgpO1xuICB9XG5cbiAgX190cmFuc2Zvcm1EYXRhVHlwZShyYW5nZTogQXJyYXk8YW55Pik6IEFycmF5PGFueT4ge1xuICAgIHJldHVybiByYW5nZS5tYXAoTmF0aXZlQW5pbWF0ZWRIZWxwZXIudHJhbnNmb3JtRGF0YVR5cGUpO1xuICB9XG5cbiAgX19nZXROYXRpdmVDb25maWcoKTogYW55IHtcbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgTmF0aXZlQW5pbWF0ZWRIZWxwZXIudmFsaWRhdGVJbnRlcnBvbGF0aW9uKHRoaXMuX2NvbmZpZyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlucHV0UmFuZ2U6IHRoaXMuX2NvbmZpZy5pbnB1dFJhbmdlLFxuICAgICAgLy8gT25seSB0aGUgYG91dHB1dFJhbmdlYCBjYW4gY29udGFpbiBzdHJpbmdzIHNvIHdlIGRvbid0IG5lZWQgdG8gdHJhbnNmb3JtIGBpbnB1dFJhbmdlYCBoZXJlXG4gICAgICBvdXRwdXRSYW5nZTogdGhpcy5fX3RyYW5zZm9ybURhdGFUeXBlKHRoaXMuX2NvbmZpZy5vdXRwdXRSYW5nZSksXG4gICAgICBleHRyYXBvbGF0ZUxlZnQ6XG4gICAgICAgIHRoaXMuX2NvbmZpZy5leHRyYXBvbGF0ZUxlZnQgfHwgdGhpcy5fY29uZmlnLmV4dHJhcG9sYXRlIHx8ICdleHRlbmQnLFxuICAgICAgZXh0cmFwb2xhdGVSaWdodDpcbiAgICAgICAgdGhpcy5fY29uZmlnLmV4dHJhcG9sYXRlUmlnaHQgfHwgdGhpcy5fY29uZmlnLmV4dHJhcG9sYXRlIHx8ICdleHRlbmQnLFxuICAgICAgdHlwZTogJ2ludGVycG9sYXRpb24nLFxuICAgIH07XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBBbmltYXRlZEludGVycG9sYXRpb247XG4iXX0=