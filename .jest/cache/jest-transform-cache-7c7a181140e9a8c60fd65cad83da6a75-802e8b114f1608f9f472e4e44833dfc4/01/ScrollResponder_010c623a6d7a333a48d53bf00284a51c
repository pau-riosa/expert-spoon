857936e32ba7cde738af0cca99c5895a
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _ScrollViewCommands = _interopRequireDefault(require("./ScrollView/ScrollViewCommands"));

var React = require('react');

var Dimensions = require('../Utilities/Dimensions');

var FrameRateLogger = require('../Interaction/FrameRateLogger');

var Keyboard = require('./Keyboard/Keyboard');

var ReactNative = require('../Renderer/shims/ReactNative');

var TextInputState = require('./TextInput/TextInputState');

var UIManager = require('../ReactNative/UIManager');

var Platform = require('../Utilities/Platform');

var invariant = require('invariant');

var performanceNow = require('fbjs/lib/performanceNow');

var IS_ANIMATING_TOUCH_START_THRESHOLD_MS = 16;
var ScrollResponderMixin = {
  _subscriptionKeyboardWillShow: null,
  _subscriptionKeyboardWillHide: null,
  _subscriptionKeyboardDidShow: null,
  _subscriptionKeyboardDidHide: null,
  scrollResponderMixinGetInitialState: function scrollResponderMixinGetInitialState() {
    return {
      isTouching: false,
      lastMomentumScrollBeginTime: 0,
      lastMomentumScrollEndTime: 0,
      observedScrollSinceBecomingResponder: false,
      becameResponderWhileAnimating: false
    };
  },
  scrollResponderHandleScrollShouldSetResponder: function scrollResponderHandleScrollShouldSetResponder() {
    if (this.props.disableScrollViewPanResponder === true) {
      return false;
    }

    return this.state.isTouching;
  },
  scrollResponderHandleStartShouldSetResponder: function scrollResponderHandleStartShouldSetResponder(e) {
    if (this.props.disableScrollViewPanResponder === true) {
      return false;
    }

    var currentlyFocusedTextInput = TextInputState.currentlyFocusedField();

    if (this.props.keyboardShouldPersistTaps === 'handled' && currentlyFocusedTextInput != null && ReactNative.findNodeHandle(e.target) !== currentlyFocusedTextInput) {
      return true;
    }

    return false;
  },
  scrollResponderHandleStartShouldSetResponderCapture: function scrollResponderHandleStartShouldSetResponderCapture(e) {
    if (this.scrollResponderIsAnimating()) {
      return true;
    }

    if (this.props.disableScrollViewPanResponder === true) {
      return false;
    }

    var currentlyFocusedTextInput = TextInputState.currentlyFocusedField();
    var keyboardShouldPersistTaps = this.props.keyboardShouldPersistTaps;
    var keyboardNeverPersistTaps = !keyboardShouldPersistTaps || keyboardShouldPersistTaps === 'never';
    var reactTag = ReactNative.findNodeHandle(e.target);

    if (keyboardNeverPersistTaps && currentlyFocusedTextInput != null && reactTag && !TextInputState.isTextInput(reactTag)) {
      return true;
    }

    return false;
  },
  scrollResponderHandleResponderReject: function scrollResponderHandleResponderReject() {},
  scrollResponderHandleTerminationRequest: function scrollResponderHandleTerminationRequest() {
    return !this.state.observedScrollSinceBecomingResponder;
  },
  scrollResponderHandleTouchEnd: function scrollResponderHandleTouchEnd(e) {
    var nativeEvent = e.nativeEvent;
    this.state.isTouching = nativeEvent.touches.length !== 0;
    this.props.onTouchEnd && this.props.onTouchEnd(e);
  },
  scrollResponderHandleTouchCancel: function scrollResponderHandleTouchCancel(e) {
    this.state.isTouching = false;
    this.props.onTouchCancel && this.props.onTouchCancel(e);
  },
  scrollResponderHandleResponderRelease: function scrollResponderHandleResponderRelease(e) {
    this.props.onResponderRelease && this.props.onResponderRelease(e);
    var currentlyFocusedTextInput = TextInputState.currentlyFocusedField();

    if (this.props.keyboardShouldPersistTaps !== true && this.props.keyboardShouldPersistTaps !== 'always' && currentlyFocusedTextInput != null && ReactNative.findNodeHandle(e.target) !== currentlyFocusedTextInput && !this.state.observedScrollSinceBecomingResponder && !this.state.becameResponderWhileAnimating) {
      this.props.onScrollResponderKeyboardDismissed && this.props.onScrollResponderKeyboardDismissed(e);
      TextInputState.blurTextInput(currentlyFocusedTextInput);
    }
  },
  scrollResponderHandleScroll: function scrollResponderHandleScroll(e) {
    this.state.observedScrollSinceBecomingResponder = true;
    this.props.onScroll && this.props.onScroll(e);
  },
  scrollResponderHandleResponderGrant: function scrollResponderHandleResponderGrant(e) {
    this.state.observedScrollSinceBecomingResponder = false;
    this.props.onResponderGrant && this.props.onResponderGrant(e);
    this.state.becameResponderWhileAnimating = this.scrollResponderIsAnimating();
  },
  scrollResponderHandleScrollBeginDrag: function scrollResponderHandleScrollBeginDrag(e) {
    FrameRateLogger.beginScroll();
    this.props.onScrollBeginDrag && this.props.onScrollBeginDrag(e);
  },
  scrollResponderHandleScrollEndDrag: function scrollResponderHandleScrollEndDrag(e) {
    var velocity = e.nativeEvent.velocity;

    if (!this.scrollResponderIsAnimating() && (!velocity || velocity.x === 0 && velocity.y === 0)) {
      FrameRateLogger.endScroll();
    }

    this.props.onScrollEndDrag && this.props.onScrollEndDrag(e);
  },
  scrollResponderHandleMomentumScrollBegin: function scrollResponderHandleMomentumScrollBegin(e) {
    this.state.lastMomentumScrollBeginTime = performanceNow();
    this.props.onMomentumScrollBegin && this.props.onMomentumScrollBegin(e);
  },
  scrollResponderHandleMomentumScrollEnd: function scrollResponderHandleMomentumScrollEnd(e) {
    FrameRateLogger.endScroll();
    this.state.lastMomentumScrollEndTime = performanceNow();
    this.props.onMomentumScrollEnd && this.props.onMomentumScrollEnd(e);
  },
  scrollResponderHandleTouchStart: function scrollResponderHandleTouchStart(e) {
    this.state.isTouching = true;
    this.props.onTouchStart && this.props.onTouchStart(e);
  },
  scrollResponderHandleTouchMove: function scrollResponderHandleTouchMove(e) {
    this.props.onTouchMove && this.props.onTouchMove(e);
  },
  scrollResponderIsAnimating: function scrollResponderIsAnimating() {
    var now = performanceNow();
    var timeSinceLastMomentumScrollEnd = now - this.state.lastMomentumScrollEndTime;
    var isAnimating = timeSinceLastMomentumScrollEnd < IS_ANIMATING_TOUCH_START_THRESHOLD_MS || this.state.lastMomentumScrollEndTime < this.state.lastMomentumScrollBeginTime;
    return isAnimating;
  },
  scrollResponderGetScrollableNode: function scrollResponderGetScrollableNode() {
    return this.getScrollableNode ? this.getScrollableNode() : ReactNative.findNodeHandle(this);
  },
  scrollResponderScrollTo: function scrollResponderScrollTo(x, y, animated) {
    if (typeof x === 'number') {
      console.warn('`scrollResponderScrollTo(x, y, animated)` is deprecated. Use `scrollResponderScrollTo({x: 5, y: 5, animated: true})` instead.');
    } else {
      var _ref = x || {};

      x = _ref.x;
      y = _ref.y;
      animated = _ref.animated;
    }

    var that = this;
    invariant(that.getNativeScrollRef != null, 'Expected scrollTo to be called on a scrollViewRef. If this exception occurs it is likely a bug in React Native');
    var nativeScrollRef = that.getNativeScrollRef();

    if (nativeScrollRef == null) {
      return;
    }

    _ScrollViewCommands.default.scrollTo(nativeScrollRef, x || 0, y || 0, animated !== false);
  },
  scrollResponderScrollToEnd: function scrollResponderScrollToEnd(options) {
    var animated = (options && options.animated) !== false;
    var that = this;
    invariant(that.getNativeScrollRef != null, 'Expected scrollToEnd to be called on a scrollViewRef. If this exception occurs it is likely a bug in React Native');
    var nativeScrollRef = that.getNativeScrollRef();

    if (nativeScrollRef == null) {
      return;
    }

    _ScrollViewCommands.default.scrollToEnd(nativeScrollRef, animated);
  },
  scrollResponderZoomTo: function scrollResponderZoomTo(rect, animated) {
    invariant(Platform.OS === 'ios', 'zoomToRect is not implemented');

    if ('animated' in rect) {
      animated = rect.animated;
      delete rect.animated;
    } else if (typeof animated !== 'undefined') {
      console.warn('`scrollResponderZoomTo` `animated` argument is deprecated. Use `options.animated` instead');
    }

    var that = this;
    invariant(that.getNativeScrollRef != null, 'Expected zoomToRect to be called on a scrollViewRef. If this exception occurs it is likely a bug in React Native');
    var nativeScrollRef = that.getNativeScrollRef();

    if (nativeScrollRef == null) {
      return;
    }

    _ScrollViewCommands.default.zoomToRect(nativeScrollRef, rect, animated !== false);
  },
  scrollResponderFlashScrollIndicators: function scrollResponderFlashScrollIndicators() {
    var that = this;
    invariant(that.getNativeScrollRef != null, 'Expected flashScrollIndicators to be called on a scrollViewRef. If this exception occurs it is likely a bug in React Native');
    var nativeScrollRef = that.getNativeScrollRef();

    if (nativeScrollRef == null) {
      return;
    }

    _ScrollViewCommands.default.flashScrollIndicators(nativeScrollRef);
  },
  scrollResponderScrollNativeHandleToKeyboard: function scrollResponderScrollNativeHandleToKeyboard(nodeHandle, additionalOffset, preventNegativeScrollOffset) {
    this.additionalScrollOffset = additionalOffset || 0;
    this.preventNegativeScrollOffset = !!preventNegativeScrollOffset;

    if (typeof nodeHandle === 'number') {
      UIManager.measureLayout(nodeHandle, ReactNative.findNodeHandle(this.getInnerViewNode()), this.scrollResponderTextInputFocusError, this.scrollResponderInputMeasureAndScrollToKeyboard);
    } else {
      var innerRef = this.getInnerViewRef();

      if (innerRef == null) {
        return;
      }

      nodeHandle.measureLayout(innerRef, this.scrollResponderInputMeasureAndScrollToKeyboard, this.scrollResponderTextInputFocusError);
    }
  },
  scrollResponderInputMeasureAndScrollToKeyboard: function scrollResponderInputMeasureAndScrollToKeyboard(left, top, width, height) {
    var keyboardScreenY = Dimensions.get('window').height;

    if (this.keyboardWillOpenTo) {
      keyboardScreenY = this.keyboardWillOpenTo.endCoordinates.screenY;
    }

    var scrollOffsetY = top - keyboardScreenY + height + this.additionalScrollOffset;

    if (this.preventNegativeScrollOffset) {
      scrollOffsetY = Math.max(0, scrollOffsetY);
    }

    this.scrollResponderScrollTo({
      x: 0,
      y: scrollOffsetY,
      animated: true
    });
    this.additionalOffset = 0;
    this.preventNegativeScrollOffset = false;
  },
  scrollResponderTextInputFocusError: function scrollResponderTextInputFocusError(msg) {
    console.error('Error measuring text field: ', msg);
  },
  UNSAFE_componentWillMount: function UNSAFE_componentWillMount() {
    var _ref2 = this.props,
        keyboardShouldPersistTaps = _ref2.keyboardShouldPersistTaps;

    if (typeof keyboardShouldPersistTaps === 'boolean') {
      console.warn("'keyboardShouldPersistTaps={" + (keyboardShouldPersistTaps === true ? 'true' : 'false') + "}' is deprecated. " + ("Use 'keyboardShouldPersistTaps=\"" + (keyboardShouldPersistTaps ? 'always' : 'never') + "\"' instead"));
    }

    this.keyboardWillOpenTo = null;
    this.additionalScrollOffset = 0;
    this._subscriptionKeyboardWillShow = Keyboard.addListener('keyboardWillShow', this.scrollResponderKeyboardWillShow);
    this._subscriptionKeyboardWillHide = Keyboard.addListener('keyboardWillHide', this.scrollResponderKeyboardWillHide);
    this._subscriptionKeyboardDidShow = Keyboard.addListener('keyboardDidShow', this.scrollResponderKeyboardDidShow);
    this._subscriptionKeyboardDidHide = Keyboard.addListener('keyboardDidHide', this.scrollResponderKeyboardDidHide);
  },
  componentWillUnmount: function componentWillUnmount() {
    if (this._subscriptionKeyboardWillShow != null) {
      this._subscriptionKeyboardWillShow.remove();
    }

    if (this._subscriptionKeyboardWillHide != null) {
      this._subscriptionKeyboardWillHide.remove();
    }

    if (this._subscriptionKeyboardDidShow != null) {
      this._subscriptionKeyboardDidShow.remove();
    }

    if (this._subscriptionKeyboardDidHide != null) {
      this._subscriptionKeyboardDidHide.remove();
    }
  },
  scrollResponderKeyboardWillShow: function scrollResponderKeyboardWillShow(e) {
    this.keyboardWillOpenTo = e;
    this.props.onKeyboardWillShow && this.props.onKeyboardWillShow(e);
  },
  scrollResponderKeyboardWillHide: function scrollResponderKeyboardWillHide(e) {
    this.keyboardWillOpenTo = null;
    this.props.onKeyboardWillHide && this.props.onKeyboardWillHide(e);
  },
  scrollResponderKeyboardDidShow: function scrollResponderKeyboardDidShow(e) {
    if (e) {
      this.keyboardWillOpenTo = e;
    }

    this.props.onKeyboardDidShow && this.props.onKeyboardDidShow(e);
  },
  scrollResponderKeyboardDidHide: function scrollResponderKeyboardDidHide(e) {
    this.keyboardWillOpenTo = null;
    this.props.onKeyboardDidHide && this.props.onKeyboardDidHide(e);
  }
};
var ScrollResponder = {
  Mixin: ScrollResponderMixin
};
module.exports = ScrollResponder;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNjcm9sbFJlc3BvbmRlci5qcyJdLCJuYW1lcyI6WyJSZWFjdCIsInJlcXVpcmUiLCJEaW1lbnNpb25zIiwiRnJhbWVSYXRlTG9nZ2VyIiwiS2V5Ym9hcmQiLCJSZWFjdE5hdGl2ZSIsIlRleHRJbnB1dFN0YXRlIiwiVUlNYW5hZ2VyIiwiUGxhdGZvcm0iLCJpbnZhcmlhbnQiLCJwZXJmb3JtYW5jZU5vdyIsIklTX0FOSU1BVElOR19UT1VDSF9TVEFSVF9USFJFU0hPTERfTVMiLCJTY3JvbGxSZXNwb25kZXJNaXhpbiIsIl9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxTaG93IiwiX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbEhpZGUiLCJfc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRTaG93IiwiX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkSGlkZSIsInNjcm9sbFJlc3BvbmRlck1peGluR2V0SW5pdGlhbFN0YXRlIiwiaXNUb3VjaGluZyIsImxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZSIsImxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWUiLCJvYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXIiLCJiZWNhbWVSZXNwb25kZXJXaGlsZUFuaW1hdGluZyIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbFNob3VsZFNldFJlc3BvbmRlciIsInByb3BzIiwiZGlzYWJsZVNjcm9sbFZpZXdQYW5SZXNwb25kZXIiLCJzdGF0ZSIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyIiwiZSIsImN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQiLCJjdXJyZW50bHlGb2N1c2VkRmllbGQiLCJrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzIiwiZmluZE5vZGVIYW5kbGUiLCJ0YXJnZXQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVTdGFydFNob3VsZFNldFJlc3BvbmRlckNhcHR1cmUiLCJzY3JvbGxSZXNwb25kZXJJc0FuaW1hdGluZyIsImtleWJvYXJkTmV2ZXJQZXJzaXN0VGFwcyIsInJlYWN0VGFnIiwiaXNUZXh0SW5wdXQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJSZWplY3QiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUZXJtaW5hdGlvblJlcXVlc3QiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaEVuZCIsIm5hdGl2ZUV2ZW50IiwidG91Y2hlcyIsImxlbmd0aCIsIm9uVG91Y2hFbmQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaENhbmNlbCIsIm9uVG91Y2hDYW5jZWwiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJSZWxlYXNlIiwib25SZXNwb25kZXJSZWxlYXNlIiwib25TY3JvbGxSZXNwb25kZXJLZXlib2FyZERpc21pc3NlZCIsImJsdXJUZXh0SW5wdXQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGwiLCJvblNjcm9sbCIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVJlc3BvbmRlckdyYW50Iiwib25SZXNwb25kZXJHcmFudCIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbEJlZ2luRHJhZyIsImJlZ2luU2Nyb2xsIiwib25TY3JvbGxCZWdpbkRyYWciLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGxFbmREcmFnIiwidmVsb2NpdHkiLCJ4IiwieSIsImVuZFNjcm9sbCIsIm9uU2Nyb2xsRW5kRHJhZyIsInNjcm9sbFJlc3BvbmRlckhhbmRsZU1vbWVudHVtU2Nyb2xsQmVnaW4iLCJvbk1vbWVudHVtU2Nyb2xsQmVnaW4iLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVNb21lbnR1bVNjcm9sbEVuZCIsIm9uTW9tZW50dW1TY3JvbGxFbmQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaFN0YXJ0Iiwib25Ub3VjaFN0YXJ0Iiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hNb3ZlIiwib25Ub3VjaE1vdmUiLCJub3ciLCJ0aW1lU2luY2VMYXN0TW9tZW50dW1TY3JvbGxFbmQiLCJpc0FuaW1hdGluZyIsInNjcm9sbFJlc3BvbmRlckdldFNjcm9sbGFibGVOb2RlIiwiZ2V0U2Nyb2xsYWJsZU5vZGUiLCJzY3JvbGxSZXNwb25kZXJTY3JvbGxUbyIsImFuaW1hdGVkIiwiY29uc29sZSIsIndhcm4iLCJ0aGF0IiwiZ2V0TmF0aXZlU2Nyb2xsUmVmIiwibmF0aXZlU2Nyb2xsUmVmIiwiQ29tbWFuZHMiLCJzY3JvbGxUbyIsInNjcm9sbFJlc3BvbmRlclNjcm9sbFRvRW5kIiwib3B0aW9ucyIsInNjcm9sbFRvRW5kIiwic2Nyb2xsUmVzcG9uZGVyWm9vbVRvIiwicmVjdCIsIk9TIiwiem9vbVRvUmVjdCIsInNjcm9sbFJlc3BvbmRlckZsYXNoU2Nyb2xsSW5kaWNhdG9ycyIsImZsYXNoU2Nyb2xsSW5kaWNhdG9ycyIsInNjcm9sbFJlc3BvbmRlclNjcm9sbE5hdGl2ZUhhbmRsZVRvS2V5Ym9hcmQiLCJub2RlSGFuZGxlIiwiYWRkaXRpb25hbE9mZnNldCIsInByZXZlbnROZWdhdGl2ZVNjcm9sbE9mZnNldCIsImFkZGl0aW9uYWxTY3JvbGxPZmZzZXQiLCJtZWFzdXJlTGF5b3V0IiwiZ2V0SW5uZXJWaWV3Tm9kZSIsInNjcm9sbFJlc3BvbmRlclRleHRJbnB1dEZvY3VzRXJyb3IiLCJzY3JvbGxSZXNwb25kZXJJbnB1dE1lYXN1cmVBbmRTY3JvbGxUb0tleWJvYXJkIiwiaW5uZXJSZWYiLCJnZXRJbm5lclZpZXdSZWYiLCJsZWZ0IiwidG9wIiwid2lkdGgiLCJoZWlnaHQiLCJrZXlib2FyZFNjcmVlblkiLCJnZXQiLCJrZXlib2FyZFdpbGxPcGVuVG8iLCJlbmRDb29yZGluYXRlcyIsInNjcmVlblkiLCJzY3JvbGxPZmZzZXRZIiwiTWF0aCIsIm1heCIsIm1zZyIsImVycm9yIiwiVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCIsImFkZExpc3RlbmVyIiwic2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmRXaWxsU2hvdyIsInNjcm9sbFJlc3BvbmRlcktleWJvYXJkV2lsbEhpZGUiLCJzY3JvbGxSZXNwb25kZXJLZXlib2FyZERpZFNob3ciLCJzY3JvbGxSZXNwb25kZXJLZXlib2FyZERpZEhpZGUiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInJlbW92ZSIsIm9uS2V5Ym9hcmRXaWxsU2hvdyIsIm9uS2V5Ym9hcmRXaWxsSGlkZSIsIm9uS2V5Ym9hcmREaWRTaG93Iiwib25LZXlib2FyZERpZEhpZGUiLCJTY3JvbGxSZXNwb25kZXIiLCJNaXhpbiIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVVBOzs7O0FBVUE7O0FBUkEsSUFBTUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsT0FBRCxDQUFyQjs7QUFDQSxJQUFNQyxVQUFVLEdBQUdELE9BQU8sQ0FBQyx5QkFBRCxDQUExQjs7QUFDQSxJQUFNRSxlQUFlLEdBQUdGLE9BQU8sQ0FBQyxnQ0FBRCxDQUEvQjs7QUFDQSxJQUFNRyxRQUFRLEdBQUdILE9BQU8sQ0FBQyxxQkFBRCxDQUF4Qjs7QUFDQSxJQUFNSSxXQUFXLEdBQUdKLE9BQU8sQ0FBQywrQkFBRCxDQUEzQjs7QUFDQSxJQUFNSyxjQUFjLEdBQUdMLE9BQU8sQ0FBQyw0QkFBRCxDQUE5Qjs7QUFDQSxJQUFNTSxTQUFTLEdBQUdOLE9BQU8sQ0FBQywwQkFBRCxDQUF6Qjs7QUFDQSxJQUFNTyxRQUFRLEdBQUdQLE9BQU8sQ0FBQyx1QkFBRCxDQUF4Qjs7QUFHQSxJQUFNUSxTQUFTLEdBQUdSLE9BQU8sQ0FBQyxXQUFELENBQXpCOztBQUNBLElBQU1TLGNBQWMsR0FBR1QsT0FBTyxDQUFDLHlCQUFELENBQTlCOztBQXVGQSxJQUFNVSxxQ0FBcUMsR0FBRyxFQUE5QztBQVVBLElBQU1DLG9CQUFvQixHQUFHO0FBQzNCQyxFQUFBQSw2QkFBNkIsRUFBRyxJQURMO0FBRTNCQyxFQUFBQSw2QkFBNkIsRUFBRyxJQUZMO0FBRzNCQyxFQUFBQSw0QkFBNEIsRUFBRyxJQUhKO0FBSTNCQyxFQUFBQSw0QkFBNEIsRUFBRyxJQUpKO0FBSzNCQyxFQUFBQSxtQ0FBbUMsRUFBRSwrQ0FBa0I7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QUFXMkcsaUJBQVgsQ0FBNkJ2RyxDQUE3QixDQUFoQztBQUNELEdBaG5CMEI7QUFrbkIzQmtHLEVBQUFBLDhCQUE4QixFQUFFLHdDQUFTbEcsQ0FBVCxFQUEyQjtBQUN6RCxTQUFLcUYsa0JBQUwsR0FBMEIsSUFBMUI7QUFDQSxTQUFLekYsS0FBTCxDQUFXNEcsaUJBQVgsSUFBZ0MsS0FBSzVHLEtBQUwsQ0FBVzRHLGlCQUFYLENBQTZCeEcsQ0FBN0IsQ0FBaEM7QUFDRDtBQXJuQjBCLENBQTdCO0FBd25CQSxJQUFNeUcsZUFBZSxHQUFHO0FBQ3RCQyxFQUFBQSxLQUFLLEVBQUUxSDtBQURlLENBQXhCO0FBSUEySCxNQUFNLENBQUNDLE9BQVAsR0FBaUJILGVBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZm9ybWF0XG4gKiBAZmxvd1xuICovXG5cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xuY29uc3QgRGltZW5zaW9ucyA9IHJlcXVpcmUoJy4uL1V0aWxpdGllcy9EaW1lbnNpb25zJyk7XG5jb25zdCBGcmFtZVJhdGVMb2dnZXIgPSByZXF1aXJlKCcuLi9JbnRlcmFjdGlvbi9GcmFtZVJhdGVMb2dnZXInKTtcbmNvbnN0IEtleWJvYXJkID0gcmVxdWlyZSgnLi9LZXlib2FyZC9LZXlib2FyZCcpO1xuY29uc3QgUmVhY3ROYXRpdmUgPSByZXF1aXJlKCcuLi9SZW5kZXJlci9zaGltcy9SZWFjdE5hdGl2ZScpO1xuY29uc3QgVGV4dElucHV0U3RhdGUgPSByZXF1aXJlKCcuL1RleHRJbnB1dC9UZXh0SW5wdXRTdGF0ZScpO1xuY29uc3QgVUlNYW5hZ2VyID0gcmVxdWlyZSgnLi4vUmVhY3ROYXRpdmUvVUlNYW5hZ2VyJyk7XG5jb25zdCBQbGF0Zm9ybSA9IHJlcXVpcmUoJy4uL1V0aWxpdGllcy9QbGF0Zm9ybScpO1xuaW1wb3J0IENvbW1hbmRzIGZyb20gJy4vU2Nyb2xsVmlldy9TY3JvbGxWaWV3Q29tbWFuZHMnO1xuXG5jb25zdCBpbnZhcmlhbnQgPSByZXF1aXJlKCdpbnZhcmlhbnQnKTtcbmNvbnN0IHBlcmZvcm1hbmNlTm93ID0gcmVxdWlyZSgnZmJqcy9saWIvcGVyZm9ybWFuY2VOb3cnKTtcblxuaW1wb3J0IHR5cGUge1ByZXNzRXZlbnQsIFNjcm9sbEV2ZW50fSBmcm9tICcuLi9UeXBlcy9Db3JlRXZlbnRUeXBlcyc7XG5pbXBvcnQgdHlwZW9mIFNjcm9sbFZpZXcgZnJvbSAnLi9TY3JvbGxWaWV3L1Njcm9sbFZpZXcnO1xuaW1wb3J0IHR5cGUge1Byb3BzIGFzIFNjcm9sbFZpZXdQcm9wc30gZnJvbSAnLi9TY3JvbGxWaWV3L1Njcm9sbFZpZXcnO1xuaW1wb3J0IHR5cGUge0tleWJvYXJkRXZlbnR9IGZyb20gJy4vS2V5Ym9hcmQvS2V5Ym9hcmQnO1xuaW1wb3J0IHR5cGUgRW1pdHRlclN1YnNjcmlwdGlvbiBmcm9tICcuLi92ZW5kb3IvZW1pdHRlci9FbWl0dGVyU3Vic2NyaXB0aW9uJztcbmltcG9ydCB0eXBlIHtIb3N0Q29tcG9uZW50fSBmcm9tICcuLi9SZW5kZXJlci9zaGltcy9SZWFjdE5hdGl2ZVR5cGVzJztcblxuLyoqXG4gKiBNaXhpbiB0aGF0IGNhbiBiZSBpbnRlZ3JhdGVkIGluIG9yZGVyIHRvIGhhbmRsZSBzY3JvbGxpbmcgdGhhdCBwbGF5cyB3ZWxsXG4gKiB3aXRoIGBSZXNwb25kZXJFdmVudFBsdWdpbmAuIEludGVncmF0ZSB3aXRoIHlvdXIgcGxhdGZvcm0gc3BlY2lmaWMgc2Nyb2xsXG4gKiB2aWV3cywgb3IgZXZlbiB5b3VyIGN1c3RvbSBidWlsdCAoZXZlcnktZnJhbWUgYW5pbWF0aW5nKSBzY3JvbGwgdmlld3Mgc28gdGhhdFxuICogYWxsIG9mIHRoZXNlIHN5c3RlbXMgcGxheSB3ZWxsIHdpdGggdGhlIGBSZXNwb25kZXJFdmVudFBsdWdpbmAuXG4gKlxuICogaU9TIHNjcm9sbCBldmVudCB0aW1pbmcgbnVhbmNlczpcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqXG4gKlxuICogU2Nyb2xsaW5nIHdpdGhvdXQgYm91bmNpbmcsIGlmIHlvdSB0b3VjaCBkb3duOlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICpcbiAqIDEuIGBvbk1vbWVudHVtU2Nyb2xsQmVnaW5gICh3aGVuIGFuaW1hdGlvbiBiZWdpbnMgYWZ0ZXIgbGV0dGluZyB1cClcbiAqICAgIC4uLiBwaHlzaWNhbCB0b3VjaCBzdGFydHMgLi4uXG4gKiAyLiBgb25Ub3VjaFN0YXJ0Q2FwdHVyZWAgICAod2hlbiB5b3UgcHJlc3MgZG93biB0byBzdG9wIHRoZSBzY3JvbGwpXG4gKiAzLiBgb25Ub3VjaFN0YXJ0YCAgICAgICAgICAoc2FtZSwgYnV0IGJ1YmJsZSBwaGFzZSlcbiAqIDQuIGBvblJlc3BvbmRlclJlbGVhc2VgICAgICh3aGVuIGxpZnRpbmcgdXAgLSB5b3UgY291bGQgcGF1c2UgZm9yZXZlciBiZWZvcmUgKiBsaWZ0aW5nKVxuICogNS4gYG9uTW9tZW50dW1TY3JvbGxFbmRgXG4gKlxuICpcbiAqIFNjcm9sbGluZyB3aXRoIGJvdW5jaW5nLCBpZiB5b3UgdG91Y2ggZG93bjpcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqXG4gKiAxLiBgb25Nb21lbnR1bVNjcm9sbEJlZ2luYCAod2hlbiBhbmltYXRpb24gYmVnaW5zIGFmdGVyIGxldHRpbmcgdXApXG4gKiAgICAuLi4gYm91bmNlIGJlZ2lucyAuLi5cbiAqICAgIC4uLiBzb21lIHRpbWUgZWxhcHNlcyAuLi5cbiAqICAgIC4uLiBwaHlzaWNhbCB0b3VjaCBkdXJpbmcgYm91bmNlIC4uLlxuICogMi4gYG9uTW9tZW50dW1TY3JvbGxFbmRgICAgKE1ha2VzIG5vIHNlbnNlIHdoeSB0aGlzIG9jY3VycyBmaXJzdCBkdXJpbmcgYm91bmNlKVxuICogMy4gYG9uVG91Y2hTdGFydENhcHR1cmVgICAgKGltbWVkaWF0ZWx5IGFmdGVyIGBvbk1vbWVudHVtU2Nyb2xsRW5kYClcbiAqIDQuIGBvblRvdWNoU3RhcnRgICAgICAgICAgIChzYW1lLCBidXQgYnViYmxlIHBoYXNlKVxuICogNS4gYG9uVG91Y2hFbmRgICAgICAgICAgICAgKFlvdSBjb3VsZCBob2xkIHRoZSB0b3VjaCBzdGFydCBmb3IgYSBsb25nIHRpbWUpXG4gKiA2LiBgb25Nb21lbnR1bVNjcm9sbEJlZ2luYCAoV2hlbiByZWxlYXNpbmcgdGhlIHZpZXcgc3RhcnRzIGJvdW5jaW5nIGJhY2spXG4gKlxuICogU28gd2hlbiB3ZSByZWNlaXZlIGFuIGBvblRvdWNoU3RhcnRgLCBob3cgY2FuIHdlIHRlbGwgaWYgd2UgYXJlIHRvdWNoaW5nXG4gKiAqZHVyaW5nKiBhbiBhbmltYXRpb24gKHdoaWNoIHRoZW4gY2F1c2VzIHRoZSBhbmltYXRpb24gdG8gc3RvcCk/IFRoZSBvbmx5IHdheVxuICogdG8gdGVsbCBpcyBpZiB0aGUgYHRvdWNoU3RhcnRgIG9jY3VycmVkIGltbWVkaWF0ZWx5IGFmdGVyIHRoZVxuICogYG9uTW9tZW50dW1TY3JvbGxFbmRgLlxuICpcbiAqIFRoaXMgaXMgYWJzdHJhY3RlZCBvdXQgZm9yIHlvdSwgc28geW91IGNhbiBqdXN0IGNhbGwgdGhpcy5zY3JvbGxSZXNwb25kZXJJc0FuaW1hdGluZygpIGlmXG4gKiBuZWNlc3NhcnlcbiAqXG4gKiBgU2Nyb2xsUmVzcG9uZGVyYCBhbHNvIGluY2x1ZGVzIGxvZ2ljIGZvciBibHVycmluZyBhIGN1cnJlbnRseSBmb2N1c2VkIGlucHV0XG4gKiBpZiBvbmUgaXMgZm9jdXNlZCB3aGlsZSBzY3JvbGxpbmcuIFRoZSBgU2Nyb2xsUmVzcG9uZGVyYCBpcyBhIG5hdHVyYWwgcGxhY2VcbiAqIHRvIHB1dCB0aGlzIGxvZ2ljIHNpbmNlIGl0IGNhbiBzdXBwb3J0IG5vdCBkaXNtaXNzaW5nIHRoZSBrZXlib2FyZCB3aGlsZVxuICogc2Nyb2xsaW5nLCB1bmxlc3MgYSByZWNvZ25pemVkIFwidGFwXCItbGlrZSBnZXN0dXJlIGhhcyBvY2N1cnJlZC5cbiAqXG4gKiBUaGUgcHVibGljIGxpZmVjeWNsZSBBUEkgaW5jbHVkZXMgZXZlbnRzIGZvciBrZXlib2FyZCBpbnRlcmFjdGlvbiwgcmVzcG9uZGVyXG4gKiBpbnRlcmFjdGlvbiwgYW5kIHNjcm9sbGluZyAoYW1vbmcgb3RoZXJzKS4gVGhlIGtleWJvYXJkIGNhbGxiYWNrc1xuICogYG9uS2V5Ym9hcmRXaWxsL0RpZC8qYCBhcmUgKmdsb2JhbCogZXZlbnRzLCBidXQgYXJlIGludm9rZWQgb24gc2Nyb2xsXG4gKiByZXNwb25kZXIncyBwcm9wcyBzbyB0aGF0IHlvdSBjYW4gZ3VhcmFudGVlIHRoYXQgdGhlIHNjcm9sbCByZXNwb25kZXInc1xuICogaW50ZXJuYWwgc3RhdGUgaGFzIGJlZW4gdXBkYXRlZCBhY2NvcmRpbmdseSAoYW5kIGRldGVybWluaXN0aWNhbGx5KSBieVxuICogdGhlIHRpbWUgdGhlIHByb3BzIGNhbGxiYWNrcyBhcmUgaW52b2tlLiBPdGhlcndpc2UsIHlvdSB3b3VsZCBhbHdheXMgd29uZGVyXG4gKiBpZiB0aGUgc2Nyb2xsIHJlc3BvbmRlciBpcyBjdXJyZW50bHkgaW4gYSBzdGF0ZSB3aGVyZSBpdCByZWNvZ25pemVzIG5ld1xuICoga2V5Ym9hcmQgcG9zaXRpb25zIGV0Yy4gSWYgY29vcmRpbmF0aW5nIHNjcm9sbGluZyB3aXRoIGtleWJvYXJkIG1vdmVtZW50LFxuICogKmFsd2F5cyogdXNlIHRoZXNlIGhvb2tzIGluc3RlYWQgb2YgbGlzdGVuaW5nIHRvIHlvdXIgb3duIGdsb2JhbCBrZXlib2FyZFxuICogZXZlbnRzLlxuICpcbiAqIFB1YmxpYyBrZXlib2FyZCBsaWZlY3ljbGUgQVBJOiAocHJvcHMgY2FsbGJhY2tzKVxuICpcbiAqIFN0YW5kYXJkIEtleWJvYXJkIEFwcGVhcmFuY2UgU2VxdWVuY2U6XG4gKlxuICogICB0aGlzLnByb3BzLm9uS2V5Ym9hcmRXaWxsU2hvd1xuICogICB0aGlzLnByb3BzLm9uS2V5Ym9hcmREaWRTaG93XG4gKlxuICogYG9uU2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaXNtaXNzZWRgIHdpbGwgYmUgaW52b2tlZCBpZiBhbiBhcHByb3ByaWF0ZVxuICogdGFwIGluc2lkZSB0aGUgc2Nyb2xsIHJlc3BvbmRlcidzIHNjcm9sbGFibGUgcmVnaW9uIHdhcyByZXNwb25zaWJsZVxuICogZm9yIHRoZSBkaXNtaXNzYWwgb2YgdGhlIGtleWJvYXJkLiBUaGVyZSBhcmUgb3RoZXIgcmVhc29ucyB3aHkgdGhlXG4gKiBrZXlib2FyZCBjb3VsZCBiZSBkaXNtaXNzZWQuXG4gKlxuICogICB0aGlzLnByb3BzLm9uU2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaXNtaXNzZWRcbiAqXG4gKiBTdGFuZGFyZCBLZXlib2FyZCBIaWRlIFNlcXVlbmNlOlxuICpcbiAqICAgdGhpcy5wcm9wcy5vbktleWJvYXJkV2lsbEhpZGVcbiAqICAgdGhpcy5wcm9wcy5vbktleWJvYXJkRGlkSGlkZVxuICovXG5cbmNvbnN0IElTX0FOSU1BVElOR19UT1VDSF9TVEFSVF9USFJFU0hPTERfTVMgPSAxNjtcblxuZXhwb3J0IHR5cGUgU3RhdGUgPSB7fFxuICBpc1RvdWNoaW5nOiBib29sZWFuLFxuICBsYXN0TW9tZW50dW1TY3JvbGxCZWdpblRpbWU6IG51bWJlcixcbiAgbGFzdE1vbWVudHVtU2Nyb2xsRW5kVGltZTogbnVtYmVyLFxuICBvYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXI6IGJvb2xlYW4sXG4gIGJlY2FtZVJlc3BvbmRlcldoaWxlQW5pbWF0aW5nOiBib29sZWFuLFxufH07XG5cbmNvbnN0IFNjcm9sbFJlc3BvbmRlck1peGluID0ge1xuICBfc3Vic2NyaXB0aW9uS2V5Ym9hcmRXaWxsU2hvdzogKG51bGw6ID9FbWl0dGVyU3Vic2NyaXB0aW9uKSxcbiAgX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbEhpZGU6IChudWxsOiA/RW1pdHRlclN1YnNjcmlwdGlvbiksXG4gIF9zdWJzY3JpcHRpb25LZXlib2FyZERpZFNob3c6IChudWxsOiA/RW1pdHRlclN1YnNjcmlwdGlvbiksXG4gIF9zdWJzY3JpcHRpb25LZXlib2FyZERpZEhpZGU6IChudWxsOiA/RW1pdHRlclN1YnNjcmlwdGlvbiksXG4gIHNjcm9sbFJlc3BvbmRlck1peGluR2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpOiBTdGF0ZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlzVG91Y2hpbmc6IGZhbHNlLFxuICAgICAgbGFzdE1vbWVudHVtU2Nyb2xsQmVnaW5UaW1lOiAwLFxuICAgICAgbGFzdE1vbWVudHVtU2Nyb2xsRW5kVGltZTogMCxcblxuICAgICAgLy8gUmVzZXQgdG8gZmFsc2UgZXZlcnkgdGltZSBiZWNvbWVzIHJlc3BvbmRlci4gVGhpcyBpcyB1c2VkIHRvOlxuICAgICAgLy8gLSBEZXRlcm1pbmUgaWYgdGhlIHNjcm9sbCB2aWV3IGhhcyBiZWVuIHNjcm9sbGVkIGFuZCB0aGVyZWZvcmUgc2hvdWxkXG4gICAgICAvLyByZWZ1c2UgdG8gZ2l2ZSB1cCBpdHMgcmVzcG9uZGVyIGxvY2suXG4gICAgICAvLyAtIERldGVybWluZSBpZiByZWxlYXNpbmcgc2hvdWxkIGRpc21pc3MgdGhlIGtleWJvYXJkIHdoZW4gd2UgYXJlIGluXG4gICAgICAvLyB0YXAtdG8tZGlzbWlzcyBtb2RlICh0aGlzLnByb3BzLmtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgIT09ICdhbHdheXMnKS5cbiAgICAgIG9ic2VydmVkU2Nyb2xsU2luY2VCZWNvbWluZ1Jlc3BvbmRlcjogZmFsc2UsXG4gICAgICBiZWNhbWVSZXNwb25kZXJXaGlsZUFuaW1hdGluZzogZmFsc2UsXG4gICAgfTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25TY3JvbGxgIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlU2Nyb2xsU2hvdWxkU2V0UmVzcG9uZGVyOiBmdW5jdGlvbigpOiBib29sZWFuIHtcbiAgICAvLyBBbGxvdyBhbnkgZXZlbnQgdG91Y2ggcGFzcyB0aHJvdWdoIGlmIHRoZSBkZWZhdWx0IHBhbiByZXNwb25kZXIgaXMgZGlzYWJsZWRcbiAgICBpZiAodGhpcy5wcm9wcy5kaXNhYmxlU2Nyb2xsVmlld1BhblJlc3BvbmRlciA9PT0gdHJ1ZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5zdGF0ZS5pc1RvdWNoaW5nO1xuICB9LFxuXG4gIC8qKlxuICAgKiBNZXJlbHkgdG91Y2ggc3RhcnRpbmcgaXMgbm90IHN1ZmZpY2llbnQgZm9yIGEgc2Nyb2xsIHZpZXcgdG8gYmVjb21lIHRoZVxuICAgKiByZXNwb25kZXIuIEJlaW5nIHRoZSBcInJlc3BvbmRlclwiIG1lYW5zIHRoYXQgdGhlIHZlcnkgbmV4dCB0b3VjaCBtb3ZlL2VuZFxuICAgKiBldmVudCB3aWxsIHJlc3VsdCBpbiBhbiBhY3Rpb24vbW92ZW1lbnQuXG4gICAqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXJgIGV2ZW50LlxuICAgKlxuICAgKiBgb25TdGFydFNob3VsZFNldFJlc3BvbmRlcmAgaXMgdXNlZCB3aGVuIHRoZSBuZXh0IG1vdmUvZW5kIHdpbGwgdHJpZ2dlclxuICAgKiBzb21lIFVJIG1vdmVtZW50L2FjdGlvbiwgYnV0IHdoZW4geW91IHdhbnQgdG8geWllbGQgcHJpb3JpdHkgdG8gdmlld3NcbiAgICogbmVzdGVkIGluc2lkZSBvZiB0aGUgdmlldy5cbiAgICpcbiAgICogVGhlcmUgbWF5IGJlIHNvbWUgY2FzZXMgd2hlcmUgc2Nyb2xsIHZpZXdzIGFjdHVhbGx5IHNob3VsZCByZXR1cm4gYHRydWVgXG4gICAqIGZyb20gYG9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXJgOiBBbnkgdGltZSB3ZSBhcmUgZGV0ZWN0aW5nIGEgc3RhbmRhcmQgdGFwXG4gICAqIHRoYXQgZ2l2ZXMgcHJpb3JpdHkgdG8gbmVzdGVkIHZpZXdzLlxuICAgKlxuICAgKiAtIElmIGEgc2luZ2xlIHRhcCBvbiB0aGUgc2Nyb2xsIHZpZXcgdHJpZ2dlcnMgYW4gYWN0aW9uIHN1Y2ggYXNcbiAgICogICByZWNlbnRlcmluZyBhIG1hcCBzdHlsZSB2aWV3IHlldCB3YW50cyB0byBnaXZlIHByaW9yaXR5IHRvIGludGVyYWN0aW9uXG4gICAqICAgdmlld3MgaW5zaWRlIChzdWNoIGFzIGRyb3BwZWQgcGlucyBvciBsYWJlbHMpLCB0aGVuIHdlIHdvdWxkIHJldHVybiB0cnVlXG4gICAqICAgZnJvbSB0aGlzIG1ldGhvZCB3aGVuIHRoZXJlIGlzIGEgc2luZ2xlIHRvdWNoLlxuICAgKlxuICAgKiAtIFNpbWlsYXIgdG8gdGhlIHByZXZpb3VzIGNhc2UsIGlmIGEgdHdvIGZpbmdlciBcInRhcFwiIHNob3VsZCB0cmlnZ2VyIGFcbiAgICogICB6b29tLCB3ZSB3b3VsZCBjaGVjayB0aGUgYHRvdWNoZXNgIGNvdW50LCBhbmQgaWYgYD49IDJgLCB3ZSB3b3VsZCByZXR1cm5cbiAgICogICB0cnVlLlxuICAgKlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlU3RhcnRTaG91bGRTZXRSZXNwb25kZXI6IGZ1bmN0aW9uKFxuICAgIGU6IFByZXNzRXZlbnQsXG4gICk6IGJvb2xlYW4ge1xuICAgIC8vIEFsbG93IGFueSBldmVudCB0b3VjaCBwYXNzIHRocm91Z2ggaWYgdGhlIGRlZmF1bHQgcGFuIHJlc3BvbmRlciBpcyBkaXNhYmxlZFxuICAgIGlmICh0aGlzLnByb3BzLmRpc2FibGVTY3JvbGxWaWV3UGFuUmVzcG9uZGVyID09PSB0cnVlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3QgY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCA9IFRleHRJbnB1dFN0YXRlLmN1cnJlbnRseUZvY3VzZWRGaWVsZCgpO1xuXG4gICAgaWYgKFxuICAgICAgdGhpcy5wcm9wcy5rZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzID09PSAnaGFuZGxlZCcgJiZcbiAgICAgIGN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQgIT0gbnVsbCAmJlxuICAgICAgUmVhY3ROYXRpdmUuZmluZE5vZGVIYW5kbGUoZS50YXJnZXQpICE9PSBjdXJyZW50bHlGb2N1c2VkVGV4dElucHV0XG4gICAgKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuXG4gIC8qKlxuICAgKiBUaGVyZSBhcmUgdGltZXMgd2hlbiB0aGUgc2Nyb2xsIHZpZXcgd2FudHMgdG8gYmVjb21lIHRoZSByZXNwb25kZXJcbiAgICogKG1lYW5pbmcgcmVzcG9uZCB0byB0aGUgbmV4dCBpbW1lZGlhdGUgYHRvdWNoU3RhcnQvdG91Y2hFbmRgKSwgaW4gYSB3YXlcbiAgICogdGhhdCAqZG9lc24ndCogZ2l2ZSBwcmlvcml0eSB0byBuZXN0ZWQgdmlld3MgKGhlbmNlIHRoZSBjYXB0dXJlIHBoYXNlKTpcbiAgICpcbiAgICogLSBDdXJyZW50bHkgYW5pbWF0aW5nLlxuICAgKiAtIFRhcHBpbmcgYW55d2hlcmUgdGhhdCBpcyBub3QgYSB0ZXh0IGlucHV0LCB3aGlsZSB0aGUga2V5Ym9hcmQgaXNcbiAgICogICB1cCAod2hpY2ggc2hvdWxkIGRpc21pc3MgdGhlIGtleWJvYXJkKS5cbiAgICpcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25TdGFydFNob3VsZFNldFJlc3BvbmRlckNhcHR1cmVgIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlU3RhcnRTaG91bGRTZXRSZXNwb25kZXJDYXB0dXJlOiBmdW5jdGlvbihcbiAgICBlOiBQcmVzc0V2ZW50LFxuICApOiBib29sZWFuIHtcbiAgICAvLyBUaGUgc2Nyb2xsIHZpZXcgc2hvdWxkIHJlY2VpdmUgdGFwcyBpbnN0ZWFkIG9mIGl0cyBkZXNjZW5kYW50cyBpZjpcbiAgICAvLyAqIGl0IGlzIGFscmVhZHkgYW5pbWF0aW5nL2RlY2VsZXJhdGluZ1xuICAgIGlmICh0aGlzLnNjcm9sbFJlc3BvbmRlcklzQW5pbWF0aW5nKCkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIEFsbG93IGFueSBldmVudCB0b3VjaCBwYXNzIHRocm91Z2ggaWYgdGhlIGRlZmF1bHQgcGFuIHJlc3BvbmRlciBpcyBkaXNhYmxlZFxuICAgIGlmICh0aGlzLnByb3BzLmRpc2FibGVTY3JvbGxWaWV3UGFuUmVzcG9uZGVyID09PSB0cnVlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gKiB0aGUga2V5Ym9hcmQgaXMgdXAsIGtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgaXMgJ25ldmVyJyAodGhlIGRlZmF1bHQpLFxuICAgIC8vIGFuZCBhIG5ldyB0b3VjaCBzdGFydHMgd2l0aCBhIG5vbi10ZXh0aW5wdXQgdGFyZ2V0IChpbiB3aGljaCBjYXNlIHRoZVxuICAgIC8vIGZpcnN0IHRhcCBzaG91bGQgYmUgc2VudCB0byB0aGUgc2Nyb2xsIHZpZXcgYW5kIGRpc21pc3MgdGhlIGtleWJvYXJkLFxuICAgIC8vIHRoZW4gdGhlIHNlY29uZCB0YXAgZ29lcyB0byB0aGUgYWN0dWFsIGludGVyaW9yIHZpZXcpXG4gICAgY29uc3QgY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCA9IFRleHRJbnB1dFN0YXRlLmN1cnJlbnRseUZvY3VzZWRGaWVsZCgpO1xuICAgIGNvbnN0IHtrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3Qga2V5Ym9hcmROZXZlclBlcnNpc3RUYXBzID1cbiAgICAgICFrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzIHx8IGtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgPT09ICduZXZlcic7XG5cbiAgICBjb25zdCByZWFjdFRhZyA9IFJlYWN0TmF0aXZlLmZpbmROb2RlSGFuZGxlKGUudGFyZ2V0KTtcbiAgICBpZiAoXG4gICAgICBrZXlib2FyZE5ldmVyUGVyc2lzdFRhcHMgJiZcbiAgICAgIGN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQgIT0gbnVsbCAmJlxuICAgICAgcmVhY3RUYWcgJiZcbiAgICAgICFUZXh0SW5wdXRTdGF0ZS5pc1RleHRJbnB1dChyZWFjdFRhZylcbiAgICApIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25SZXNwb25kZXJSZWplY3RgIGV2ZW50LlxuICAgKlxuICAgKiBTb21lIG90aGVyIGVsZW1lbnQgaXMgbm90IHlpZWxkaW5nIGl0cyByb2xlIGFzIHJlc3BvbmRlci4gTm9ybWFsbHksIHdlJ2RcbiAgICoganVzdCBkaXNhYmxlIHRoZSBgVUlTY3JvbGxWaWV3YCwgYnV0IGEgdG91Y2ggaGFzIGFscmVhZHkgYmVnYW4gb24gaXQsIHRoZVxuICAgKiBgVUlTY3JvbGxWaWV3YCB3aWxsIG5vdCBhY2NlcHQgYmVpbmcgZGlzYWJsZWQgYWZ0ZXIgdGhhdC4gVGhlIGVhc2llc3RcbiAgICogc29sdXRpb24gZm9yIG5vdyBpcyB0byBhY2NlcHQgdGhlIGxpbWl0YXRpb24gb2YgZGlzYWxsb3dpbmcgdGhpc1xuICAgKiBhbHRvZ2V0aGVyLiBUbyBpbXByb3ZlIHRoaXMsIGZpbmQgYSB3YXkgdG8gZGlzYWJsZSB0aGUgYFVJU2Nyb2xsVmlld2AgYWZ0ZXJcbiAgICogYSB0b3VjaCBoYXMgYWxyZWFkeSBzdGFydGVkLlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlUmVzcG9uZGVyUmVqZWN0OiBmdW5jdGlvbigpIHt9LFxuXG4gIC8qKlxuICAgKiBXZSB3aWxsIGFsbG93IHRoZSBzY3JvbGwgdmlldyB0byBnaXZlIHVwIGl0cyBsb2NrIGlmZiBpdCBhY3F1aXJlZCB0aGUgbG9ja1xuICAgKiBkdXJpbmcgYW4gYW5pbWF0aW9uLiBUaGlzIGlzIGEgdmVyeSB1c2VmdWwgZGVmYXVsdCB0aGF0IGhhcHBlbnMgdG8gc2F0aXNmeVxuICAgKiBtYW55IGNvbW1vbiB1c2VyIGV4cGVyaWVuY2VzLlxuICAgKlxuICAgKiAtIFN0b3AgYSBzY3JvbGwgb24gdGhlIGxlZnQgZWRnZSwgdGhlbiB0dXJuIHRoYXQgaW50byBhbiBvdXRlciB2aWV3J3NcbiAgICogICBiYWNrc3dpcGUuXG4gICAqIC0gU3RvcCBhIHNjcm9sbCBtaWQtYm91bmNlIGF0IHRoZSB0b3AsIGNvbnRpbnVlIHB1bGxpbmcgdG8gaGF2ZSB0aGUgb3V0ZXJcbiAgICogICB2aWV3IGRpc21pc3MuXG4gICAqIC0gSG93ZXZlciwgd2l0aG91dCBjYXRjaGluZyB0aGUgc2Nyb2xsIHZpZXcgbWlkLWJvdW5jZSAod2hpbGUgaXQgaXNcbiAgICogICBtb3Rpb25sZXNzKSwgaWYgeW91IGRyYWcgZmFyIGVub3VnaCBmb3IgdGhlIHNjcm9sbCB2aWV3IHRvIGJlY29tZVxuICAgKiAgIHJlc3BvbmRlciAoYW5kIHRoZXJlZm9yZSBkcmFnIHRoZSBzY3JvbGwgdmlldyBhIGJpdCksIGFueSBiYWNrc3dpcGVcbiAgICogICBuYXZpZ2F0aW9uIG9mIGEgc3dpcGUgZ2VzdHVyZSBoaWdoZXIgaW4gdGhlIHZpZXcgaGllcmFyY2h5LCBzaG91bGQgYmVcbiAgICogICByZWplY3RlZC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVRlcm1pbmF0aW9uUmVxdWVzdDogZnVuY3Rpb24oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLnN0YXRlLm9ic2VydmVkU2Nyb2xsU2luY2VCZWNvbWluZ1Jlc3BvbmRlcjtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25Ub3VjaEVuZGAgZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSB7UHJlc3NFdmVudH0gZSBFdmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVRvdWNoRW5kOiBmdW5jdGlvbihlOiBQcmVzc0V2ZW50KSB7XG4gICAgY29uc3QgbmF0aXZlRXZlbnQgPSBlLm5hdGl2ZUV2ZW50O1xuICAgIHRoaXMuc3RhdGUuaXNUb3VjaGluZyA9IG5hdGl2ZUV2ZW50LnRvdWNoZXMubGVuZ3RoICE9PSAwO1xuICAgIHRoaXMucHJvcHMub25Ub3VjaEVuZCAmJiB0aGlzLnByb3BzLm9uVG91Y2hFbmQoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uVG91Y2hDYW5jZWxgIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge1ByZXNzRXZlbnR9IGUgRXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaENhbmNlbDogZnVuY3Rpb24oZTogUHJlc3NFdmVudCkge1xuICAgIHRoaXMuc3RhdGUuaXNUb3VjaGluZyA9IGZhbHNlO1xuICAgIHRoaXMucHJvcHMub25Ub3VjaENhbmNlbCAmJiB0aGlzLnByb3BzLm9uVG91Y2hDYW5jZWwoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uUmVzcG9uZGVyUmVsZWFzZWAgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJSZWxlYXNlOiBmdW5jdGlvbihlOiBQcmVzc0V2ZW50KSB7XG4gICAgdGhpcy5wcm9wcy5vblJlc3BvbmRlclJlbGVhc2UgJiYgdGhpcy5wcm9wcy5vblJlc3BvbmRlclJlbGVhc2UoZSk7XG5cbiAgICAvLyBCeSBkZWZhdWx0IHNjcm9sbCB2aWV3cyB3aWxsIHVuZm9jdXMgYSB0ZXh0RmllbGRcbiAgICAvLyBpZiBhbm90aGVyIHRvdWNoIG9jY3VycyBvdXRzaWRlIG9mIGl0XG4gICAgY29uc3QgY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCA9IFRleHRJbnB1dFN0YXRlLmN1cnJlbnRseUZvY3VzZWRGaWVsZCgpO1xuICAgIGlmIChcbiAgICAgIHRoaXMucHJvcHMua2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyAhPT0gdHJ1ZSAmJlxuICAgICAgdGhpcy5wcm9wcy5rZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzICE9PSAnYWx3YXlzJyAmJlxuICAgICAgY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCAhPSBudWxsICYmXG4gICAgICBSZWFjdE5hdGl2ZS5maW5kTm9kZUhhbmRsZShlLnRhcmdldCkgIT09IGN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQgJiZcbiAgICAgICF0aGlzLnN0YXRlLm9ic2VydmVkU2Nyb2xsU2luY2VCZWNvbWluZ1Jlc3BvbmRlciAmJlxuICAgICAgIXRoaXMuc3RhdGUuYmVjYW1lUmVzcG9uZGVyV2hpbGVBbmltYXRpbmdcbiAgICApIHtcbiAgICAgIHRoaXMucHJvcHMub25TY3JvbGxSZXNwb25kZXJLZXlib2FyZERpc21pc3NlZCAmJlxuICAgICAgICB0aGlzLnByb3BzLm9uU2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaXNtaXNzZWQoZSk7XG4gICAgICBUZXh0SW5wdXRTdGF0ZS5ibHVyVGV4dElucHV0KGN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQpO1xuICAgIH1cbiAgfSxcblxuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGw6IGZ1bmN0aW9uKGU6IFNjcm9sbEV2ZW50KSB7XG4gICAgKHRoaXM6IGFueSkuc3RhdGUub2JzZXJ2ZWRTY3JvbGxTaW5jZUJlY29taW5nUmVzcG9uZGVyID0gdHJ1ZTtcbiAgICAodGhpczogYW55KS5wcm9wcy5vblNjcm9sbCAmJiAodGhpczogYW55KS5wcm9wcy5vblNjcm9sbChlKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25SZXNwb25kZXJHcmFudGAgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJHcmFudDogZnVuY3Rpb24oZTogU2Nyb2xsRXZlbnQpIHtcbiAgICB0aGlzLnN0YXRlLm9ic2VydmVkU2Nyb2xsU2luY2VCZWNvbWluZ1Jlc3BvbmRlciA9IGZhbHNlO1xuICAgIHRoaXMucHJvcHMub25SZXNwb25kZXJHcmFudCAmJiB0aGlzLnByb3BzLm9uUmVzcG9uZGVyR3JhbnQoZSk7XG4gICAgdGhpcy5zdGF0ZS5iZWNhbWVSZXNwb25kZXJXaGlsZUFuaW1hdGluZyA9IHRoaXMuc2Nyb2xsUmVzcG9uZGVySXNBbmltYXRpbmcoKTtcbiAgfSxcblxuICAvKipcbiAgICogVW5mb3J0dW5hdGVseSwgYG9uU2Nyb2xsQmVnaW5EcmFnYCBhbHNvIGZpcmVzIHdoZW4gKnN0b3BwaW5nKiB0aGUgc2Nyb2xsXG4gICAqIGFuaW1hdGlvbiwgYW5kIHRoZXJlJ3Mgbm90IGFuIGVhc3kgd2F5IHRvIGRpc3Rpbmd1aXNoIGEgZHJhZyB2cy4gc3RvcHBpbmdcbiAgICogbW9tZW50dW0uXG4gICAqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uU2Nyb2xsQmVnaW5EcmFnYCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbEJlZ2luRHJhZzogZnVuY3Rpb24oZTogU2Nyb2xsRXZlbnQpIHtcbiAgICBGcmFtZVJhdGVMb2dnZXIuYmVnaW5TY3JvbGwoKTsgLy8gVE9ETzogdHJhY2sgYWxsIHNjcm9sbHMgYWZ0ZXIgaW1wbGVtZW50aW5nIG9uU2Nyb2xsRW5kQW5pbWF0aW9uXG4gICAgdGhpcy5wcm9wcy5vblNjcm9sbEJlZ2luRHJhZyAmJiB0aGlzLnByb3BzLm9uU2Nyb2xsQmVnaW5EcmFnKGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblNjcm9sbEVuZERyYWdgIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlU2Nyb2xsRW5kRHJhZzogZnVuY3Rpb24oZTogU2Nyb2xsRXZlbnQpIHtcbiAgICBjb25zdCB7dmVsb2NpdHl9ID0gZS5uYXRpdmVFdmVudDtcbiAgICAvLyAtIElmIHdlIGFyZSBhbmltYXRpbmcsIHRoZW4gdGhpcyBpcyBhIFwiZHJhZ1wiIHRoYXQgaXMgc3RvcHBpbmcgdGhlIHNjcm9sbHZpZXcgYW5kIG1vbWVudHVtIGVuZFxuICAgIC8vICAgd2lsbCBmaXJlLlxuICAgIC8vIC0gSWYgdmVsb2NpdHkgaXMgbm9uLXplcm8sIHRoZW4gdGhlIGludGVyYWN0aW9uIHdpbGwgc3RvcCB3aGVuIG1vbWVudHVtIHNjcm9sbCBlbmRzIG9yXG4gICAgLy8gICBhbm90aGVyIGRyYWcgc3RhcnRzIGFuZCBlbmRzLlxuICAgIC8vIC0gSWYgd2UgZG9uJ3QgZ2V0IHZlbG9jaXR5LCBiZXR0ZXIgdG8gc3RvcCB0aGUgaW50ZXJhY3Rpb24gdHdpY2UgdGhhbiBub3Qgc3RvcCBpdC5cbiAgICBpZiAoXG4gICAgICAhdGhpcy5zY3JvbGxSZXNwb25kZXJJc0FuaW1hdGluZygpICYmXG4gICAgICAoIXZlbG9jaXR5IHx8ICh2ZWxvY2l0eS54ID09PSAwICYmIHZlbG9jaXR5LnkgPT09IDApKVxuICAgICkge1xuICAgICAgRnJhbWVSYXRlTG9nZ2VyLmVuZFNjcm9sbCgpO1xuICAgIH1cbiAgICB0aGlzLnByb3BzLm9uU2Nyb2xsRW5kRHJhZyAmJiB0aGlzLnByb3BzLm9uU2Nyb2xsRW5kRHJhZyhlKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25Nb21lbnR1bVNjcm9sbEJlZ2luYCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZU1vbWVudHVtU2Nyb2xsQmVnaW46IGZ1bmN0aW9uKGU6IFNjcm9sbEV2ZW50KSB7XG4gICAgdGhpcy5zdGF0ZS5sYXN0TW9tZW50dW1TY3JvbGxCZWdpblRpbWUgPSBwZXJmb3JtYW5jZU5vdygpO1xuICAgIHRoaXMucHJvcHMub25Nb21lbnR1bVNjcm9sbEJlZ2luICYmIHRoaXMucHJvcHMub25Nb21lbnR1bVNjcm9sbEJlZ2luKGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvbk1vbWVudHVtU2Nyb2xsRW5kYCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZU1vbWVudHVtU2Nyb2xsRW5kOiBmdW5jdGlvbihlOiBTY3JvbGxFdmVudCkge1xuICAgIEZyYW1lUmF0ZUxvZ2dlci5lbmRTY3JvbGwoKTtcbiAgICB0aGlzLnN0YXRlLmxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWUgPSBwZXJmb3JtYW5jZU5vdygpO1xuICAgIHRoaXMucHJvcHMub25Nb21lbnR1bVNjcm9sbEVuZCAmJiB0aGlzLnByb3BzLm9uTW9tZW50dW1TY3JvbGxFbmQoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uVG91Y2hTdGFydGAgZXZlbnQuXG4gICAqXG4gICAqIFNpbmNlIHdlIGtub3cgdGhhdCB0aGUgYFNpbXBsZUV2ZW50UGx1Z2luYCBvY2N1cnMgbGF0ZXIgaW4gdGhlIHBsdWdpblxuICAgKiBvcmRlciwgYWZ0ZXIgYFJlc3BvbmRlckV2ZW50UGx1Z2luYCwgd2UgY2FuIGRldGVjdCB0aGF0IHdlIHdlcmUgKm5vdCpcbiAgICogcGVybWl0dGVkIHRvIGJlIHRoZSByZXNwb25kZXIgKHByZXN1bWFibHkgYmVjYXVzZSBhIGNvbnRhaW5lZCB2aWV3IGJlY2FtZVxuICAgKiByZXNwb25kZXIpLiBUaGUgYG9uUmVzcG9uZGVyUmVqZWN0YCB3b24ndCBmaXJlIGluIHRoYXQgY2FzZSAtIGl0IG9ubHlcbiAgICogZmlyZXMgd2hlbiBhICpjdXJyZW50KiByZXNwb25kZXIgcmVqZWN0cyBvdXIgcmVxdWVzdC5cbiAgICpcbiAgICogQHBhcmFtIHtQcmVzc0V2ZW50fSBlIFRvdWNoIFN0YXJ0IGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hTdGFydDogZnVuY3Rpb24oZTogUHJlc3NFdmVudCkge1xuICAgIHRoaXMuc3RhdGUuaXNUb3VjaGluZyA9IHRydWU7XG4gICAgdGhpcy5wcm9wcy5vblRvdWNoU3RhcnQgJiYgdGhpcy5wcm9wcy5vblRvdWNoU3RhcnQoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uVG91Y2hNb3ZlYCBldmVudC5cbiAgICpcbiAgICogU2luY2Ugd2Uga25vdyB0aGF0IHRoZSBgU2ltcGxlRXZlbnRQbHVnaW5gIG9jY3VycyBsYXRlciBpbiB0aGUgcGx1Z2luXG4gICAqIG9yZGVyLCBhZnRlciBgUmVzcG9uZGVyRXZlbnRQbHVnaW5gLCB3ZSBjYW4gZGV0ZWN0IHRoYXQgd2Ugd2VyZSAqbm90KlxuICAgKiBwZXJtaXR0ZWQgdG8gYmUgdGhlIHJlc3BvbmRlciAocHJlc3VtYWJseSBiZWNhdXNlIGEgY29udGFpbmVkIHZpZXcgYmVjYW1lXG4gICAqIHJlc3BvbmRlcikuIFRoZSBgb25SZXNwb25kZXJSZWplY3RgIHdvbid0IGZpcmUgaW4gdGhhdCBjYXNlIC0gaXQgb25seVxuICAgKiBmaXJlcyB3aGVuIGEgKmN1cnJlbnQqIHJlc3BvbmRlciByZWplY3RzIG91ciByZXF1ZXN0LlxuICAgKlxuICAgKiBAcGFyYW0ge1ByZXNzRXZlbnR9IGUgVG91Y2ggU3RhcnQgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaE1vdmU6IGZ1bmN0aW9uKGU6IFByZXNzRXZlbnQpIHtcbiAgICB0aGlzLnByb3BzLm9uVG91Y2hNb3ZlICYmIHRoaXMucHJvcHMub25Ub3VjaE1vdmUoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEEgaGVscGVyIGZ1bmN0aW9uIGZvciB0aGlzIGNsYXNzIHRoYXQgbGV0cyB1cyBxdWlja2x5IGRldGVybWluZSBpZiB0aGVcbiAgICogdmlldyBpcyBjdXJyZW50bHkgYW5pbWF0aW5nLiBUaGlzIGlzIHBhcnRpY3VsYXJseSB1c2VmdWwgdG8ga25vdyB3aGVuXG4gICAqIGEgdG91Y2ggaGFzIGp1c3Qgc3RhcnRlZCBvciBlbmRlZC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlcklzQW5pbWF0aW5nOiBmdW5jdGlvbigpOiBib29sZWFuIHtcbiAgICBjb25zdCBub3cgPSBwZXJmb3JtYW5jZU5vdygpO1xuICAgIGNvbnN0IHRpbWVTaW5jZUxhc3RNb21lbnR1bVNjcm9sbEVuZCA9XG4gICAgICBub3cgLSB0aGlzLnN0YXRlLmxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWU7XG4gICAgY29uc3QgaXNBbmltYXRpbmcgPVxuICAgICAgdGltZVNpbmNlTGFzdE1vbWVudHVtU2Nyb2xsRW5kIDwgSVNfQU5JTUFUSU5HX1RPVUNIX1NUQVJUX1RIUkVTSE9MRF9NUyB8fFxuICAgICAgdGhpcy5zdGF0ZS5sYXN0TW9tZW50dW1TY3JvbGxFbmRUaW1lIDxcbiAgICAgICAgdGhpcy5zdGF0ZS5sYXN0TW9tZW50dW1TY3JvbGxCZWdpblRpbWU7XG4gICAgcmV0dXJuIGlzQW5pbWF0aW5nO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBub2RlIHRoYXQgcmVwcmVzZW50cyBuYXRpdmUgdmlldyB0aGF0IGNhbiBiZSBzY3JvbGxlZC5cbiAgICogQ29tcG9uZW50cyBjYW4gcGFzcyB3aGF0IG5vZGUgdG8gdXNlIGJ5IGRlZmluaW5nIGEgYGdldFNjcm9sbGFibGVOb2RlYFxuICAgKiBmdW5jdGlvbiBvdGhlcndpc2UgYHRoaXNgIGlzIHVzZWQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJHZXRTY3JvbGxhYmxlTm9kZTogZnVuY3Rpb24oKTogP251bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U2Nyb2xsYWJsZU5vZGVcbiAgICAgID8gdGhpcy5nZXRTY3JvbGxhYmxlTm9kZSgpXG4gICAgICA6IFJlYWN0TmF0aXZlLmZpbmROb2RlSGFuZGxlKHRoaXMpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBBIGhlbHBlciBmdW5jdGlvbiB0byBzY3JvbGwgdG8gYSBzcGVjaWZpYyBwb2ludCBpbiB0aGUgU2Nyb2xsVmlldy5cbiAgICogVGhpcyBpcyBjdXJyZW50bHkgdXNlZCB0byBoZWxwIGZvY3VzIGNoaWxkIFRleHRWaWV3cywgYnV0IGNhbiBhbHNvXG4gICAqIGJlIHVzZWQgdG8gcXVpY2tseSBzY3JvbGwgdG8gYW55IGVsZW1lbnQgd2Ugd2FudCB0byBmb2N1cy4gU3ludGF4OlxuICAgKlxuICAgKiBgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG8ob3B0aW9uczoge3g6IG51bWJlciA9IDA7IHk6IG51bWJlciA9IDA7IGFuaW1hdGVkOiBib29sZWFuID0gdHJ1ZX0pYFxuICAgKlxuICAgKiBOb3RlOiBUaGUgd2VpcmQgYXJndW1lbnQgc2lnbmF0dXJlIGlzIGR1ZSB0byB0aGUgZmFjdCB0aGF0LCBmb3IgaGlzdG9yaWNhbCByZWFzb25zLFxuICAgKiB0aGUgZnVuY3Rpb24gYWxzbyBhY2NlcHRzIHNlcGFyYXRlIGFyZ3VtZW50cyBhcyBhcyBhbHRlcm5hdGl2ZSB0byB0aGUgb3B0aW9ucyBvYmplY3QuXG4gICAqIFRoaXMgaXMgZGVwcmVjYXRlZCBkdWUgdG8gYW1iaWd1aXR5ICh5IGJlZm9yZSB4KSwgYW5kIFNIT1VMRCBOT1QgQkUgVVNFRC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlclNjcm9sbFRvOiBmdW5jdGlvbihcbiAgICB4PzpcbiAgICAgIHwgbnVtYmVyXG4gICAgICB8IHtcbiAgICAgICAgICB4PzogbnVtYmVyLFxuICAgICAgICAgIHk/OiBudW1iZXIsXG4gICAgICAgICAgYW5pbWF0ZWQ/OiBib29sZWFuLFxuICAgICAgICAgIC4uLlxuICAgICAgICB9LFxuICAgIHk/OiBudW1iZXIsXG4gICAgYW5pbWF0ZWQ/OiBib29sZWFuLFxuICApIHtcbiAgICBpZiAodHlwZW9mIHggPT09ICdudW1iZXInKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICdgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG8oeCwgeSwgYW5pbWF0ZWQpYCBpcyBkZXByZWNhdGVkLiBVc2UgYHNjcm9sbFJlc3BvbmRlclNjcm9sbFRvKHt4OiA1LCB5OiA1LCBhbmltYXRlZDogdHJ1ZX0pYCBpbnN0ZWFkLicsXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICAoe3gsIHksIGFuaW1hdGVkfSA9IHggfHwge30pO1xuICAgIH1cblxuICAgIGNvbnN0IHRoYXQ6IFJlYWN0LkVsZW1lbnRSZWY8U2Nyb2xsVmlldz4gPSAodGhpczogYW55KTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICB0aGF0LmdldE5hdGl2ZVNjcm9sbFJlZiAhPSBudWxsLFxuICAgICAgJ0V4cGVjdGVkIHNjcm9sbFRvIHRvIGJlIGNhbGxlZCBvbiBhIHNjcm9sbFZpZXdSZWYuIElmIHRoaXMgZXhjZXB0aW9uIG9jY3VycyBpdCBpcyBsaWtlbHkgYSBidWcgaW4gUmVhY3QgTmF0aXZlJyxcbiAgICApO1xuICAgIGNvbnN0IG5hdGl2ZVNjcm9sbFJlZiA9IHRoYXQuZ2V0TmF0aXZlU2Nyb2xsUmVmKCk7XG4gICAgaWYgKG5hdGl2ZVNjcm9sbFJlZiA9PSBudWxsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIENvbW1hbmRzLnNjcm9sbFRvKG5hdGl2ZVNjcm9sbFJlZiwgeCB8fCAwLCB5IHx8IDAsIGFuaW1hdGVkICE9PSBmYWxzZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFNjcm9sbHMgdG8gdGhlIGVuZCBvZiB0aGUgU2Nyb2xsVmlldywgZWl0aGVyIGltbWVkaWF0ZWx5IG9yIHdpdGggYSBzbW9vdGhcbiAgICogYW5pbWF0aW9uLlxuICAgKlxuICAgKiBFeGFtcGxlOlxuICAgKlxuICAgKiBgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG9FbmQoe2FuaW1hdGVkOiB0cnVlfSlgXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJTY3JvbGxUb0VuZDogZnVuY3Rpb24ob3B0aW9ucz86IHthbmltYXRlZD86IGJvb2xlYW4sIC4uLn0pIHtcbiAgICAvLyBEZWZhdWx0IHRvIHRydWVcbiAgICBjb25zdCBhbmltYXRlZCA9IChvcHRpb25zICYmIG9wdGlvbnMuYW5pbWF0ZWQpICE9PSBmYWxzZTtcblxuICAgIGNvbnN0IHRoYXQ6IFJlYWN0LkVsZW1lbnRSZWY8U2Nyb2xsVmlldz4gPSAodGhpczogYW55KTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICB0aGF0LmdldE5hdGl2ZVNjcm9sbFJlZiAhPSBudWxsLFxuICAgICAgJ0V4cGVjdGVkIHNjcm9sbFRvRW5kIHRvIGJlIGNhbGxlZCBvbiBhIHNjcm9sbFZpZXdSZWYuIElmIHRoaXMgZXhjZXB0aW9uIG9jY3VycyBpdCBpcyBsaWtlbHkgYSBidWcgaW4gUmVhY3QgTmF0aXZlJyxcbiAgICApO1xuICAgIGNvbnN0IG5hdGl2ZVNjcm9sbFJlZiA9IHRoYXQuZ2V0TmF0aXZlU2Nyb2xsUmVmKCk7XG4gICAgaWYgKG5hdGl2ZVNjcm9sbFJlZiA9PSBudWxsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgQ29tbWFuZHMuc2Nyb2xsVG9FbmQobmF0aXZlU2Nyb2xsUmVmLCBhbmltYXRlZCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEEgaGVscGVyIGZ1bmN0aW9uIHRvIHpvb20gdG8gYSBzcGVjaWZpYyByZWN0IGluIHRoZSBzY3JvbGx2aWV3LiBUaGUgYXJndW1lbnQgaGFzIHRoZSBzaGFwZVxuICAgKiB7eDogbnVtYmVyOyB5OiBudW1iZXI7IHdpZHRoOiBudW1iZXI7IGhlaWdodDogbnVtYmVyOyBhbmltYXRlZDogYm9vbGVhbiA9IHRydWV9XG4gICAqXG4gICAqIEBwbGF0Zm9ybSBpb3NcbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlclpvb21UbzogZnVuY3Rpb24oXG4gICAgcmVjdDoge3xcbiAgICAgIHg6IG51bWJlcixcbiAgICAgIHk6IG51bWJlcixcbiAgICAgIHdpZHRoOiBudW1iZXIsXG4gICAgICBoZWlnaHQ6IG51bWJlcixcbiAgICAgIGFuaW1hdGVkPzogYm9vbGVhbixcbiAgICB8fSxcbiAgICBhbmltYXRlZD86IGJvb2xlYW4sIC8vIGRlcHJlY2F0ZWQsIHB1dCB0aGlzIGluc2lkZSB0aGUgcmVjdCBhcmd1bWVudCBpbnN0ZWFkXG4gICkge1xuICAgIGludmFyaWFudChQbGF0Zm9ybS5PUyA9PT0gJ2lvcycsICd6b29tVG9SZWN0IGlzIG5vdCBpbXBsZW1lbnRlZCcpO1xuICAgIGlmICgnYW5pbWF0ZWQnIGluIHJlY3QpIHtcbiAgICAgIGFuaW1hdGVkID0gcmVjdC5hbmltYXRlZDtcbiAgICAgIGRlbGV0ZSByZWN0LmFuaW1hdGVkO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGFuaW1hdGVkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAnYHNjcm9sbFJlc3BvbmRlclpvb21Ub2AgYGFuaW1hdGVkYCBhcmd1bWVudCBpcyBkZXByZWNhdGVkLiBVc2UgYG9wdGlvbnMuYW5pbWF0ZWRgIGluc3RlYWQnLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCB0aGF0OiBSZWFjdC5FbGVtZW50UmVmPFNjcm9sbFZpZXc+ID0gdGhpcztcbiAgICBpbnZhcmlhbnQoXG4gICAgICB0aGF0LmdldE5hdGl2ZVNjcm9sbFJlZiAhPSBudWxsLFxuICAgICAgJ0V4cGVjdGVkIHpvb21Ub1JlY3QgdG8gYmUgY2FsbGVkIG9uIGEgc2Nyb2xsVmlld1JlZi4gSWYgdGhpcyBleGNlcHRpb24gb2NjdXJzIGl0IGlzIGxpa2VseSBhIGJ1ZyBpbiBSZWFjdCBOYXRpdmUnLFxuICAgICk7XG4gICAgY29uc3QgbmF0aXZlU2Nyb2xsUmVmID0gdGhhdC5nZXROYXRpdmVTY3JvbGxSZWYoKTtcbiAgICBpZiAobmF0aXZlU2Nyb2xsUmVmID09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgQ29tbWFuZHMuem9vbVRvUmVjdChuYXRpdmVTY3JvbGxSZWYsIHJlY3QsIGFuaW1hdGVkICE9PSBmYWxzZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIERpc3BsYXlzIHRoZSBzY3JvbGwgaW5kaWNhdG9ycyBtb21lbnRhcmlseS5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckZsYXNoU2Nyb2xsSW5kaWNhdG9yczogZnVuY3Rpb24oKSB7XG4gICAgY29uc3QgdGhhdDogUmVhY3QuRWxlbWVudFJlZjxTY3JvbGxWaWV3PiA9ICh0aGlzOiBhbnkpO1xuICAgIGludmFyaWFudChcbiAgICAgIHRoYXQuZ2V0TmF0aXZlU2Nyb2xsUmVmICE9IG51bGwsXG4gICAgICAnRXhwZWN0ZWQgZmxhc2hTY3JvbGxJbmRpY2F0b3JzIHRvIGJlIGNhbGxlZCBvbiBhIHNjcm9sbFZpZXdSZWYuIElmIHRoaXMgZXhjZXB0aW9uIG9jY3VycyBpdCBpcyBsaWtlbHkgYSBidWcgaW4gUmVhY3QgTmF0aXZlJyxcbiAgICApO1xuICAgIGNvbnN0IG5hdGl2ZVNjcm9sbFJlZiA9IHRoYXQuZ2V0TmF0aXZlU2Nyb2xsUmVmKCk7XG4gICAgaWYgKG5hdGl2ZVNjcm9sbFJlZiA9PSBudWxsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIENvbW1hbmRzLmZsYXNoU2Nyb2xsSW5kaWNhdG9ycyhuYXRpdmVTY3JvbGxSZWYpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBUaGlzIG1ldGhvZCBzaG91bGQgYmUgdXNlZCBhcyB0aGUgY2FsbGJhY2sgdG8gb25Gb2N1cyBpbiBhIFRleHRJbnB1dHMnXG4gICAqIHBhcmVudCB2aWV3LiBOb3RlIHRoYXQgYW55IG1vZHVsZSB1c2luZyB0aGlzIG1peGluIG5lZWRzIHRvIHJldHVyblxuICAgKiB0aGUgcGFyZW50IHZpZXcncyByZWYgaW4gZ2V0U2Nyb2xsVmlld1JlZigpIGluIG9yZGVyIHRvIHVzZSB0aGlzIG1ldGhvZC5cbiAgICogQHBhcmFtIHtudW1iZXJ9IG5vZGVIYW5kbGUgVGhlIFRleHRJbnB1dCBub2RlIGhhbmRsZVxuICAgKiBAcGFyYW0ge251bWJlcn0gYWRkaXRpb25hbE9mZnNldCBUaGUgc2Nyb2xsIHZpZXcncyBib3R0b20gXCJjb250ZW50SW5zZXRcIi5cbiAgICogICAgICAgIERlZmF1bHQgaXMgMC5cbiAgICogQHBhcmFtIHtib29sfSBwcmV2ZW50TmVnYXRpdmVTY3JvbGxpbmcgV2hldGhlciB0byBhbGxvdyBwdWxsaW5nIHRoZSBjb250ZW50XG4gICAqICAgICAgICBkb3duIHRvIG1ha2UgaXQgbWVldCB0aGUga2V5Ym9hcmQncyB0b3AuIERlZmF1bHQgaXMgZmFsc2UuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJTY3JvbGxOYXRpdmVIYW5kbGVUb0tleWJvYXJkOiBmdW5jdGlvbjxUPihcbiAgICBub2RlSGFuZGxlOlxuICAgICAgfCBudW1iZXJcbiAgICAgIHwgUmVhY3QuRWxlbWVudFJlZjxIb3N0Q29tcG9uZW50PFQ+PlxuICAgICAgfCBSZWFjdC5FbGVtZW50UmVmPENsYXNzPFJlYWN0TmF0aXZlLk5hdGl2ZUNvbXBvbmVudDxUPj4+LFxuICAgIGFkZGl0aW9uYWxPZmZzZXQ/OiBudW1iZXIsXG4gICAgcHJldmVudE5lZ2F0aXZlU2Nyb2xsT2Zmc2V0PzogYm9vbGVhbixcbiAgKSB7XG4gICAgdGhpcy5hZGRpdGlvbmFsU2Nyb2xsT2Zmc2V0ID0gYWRkaXRpb25hbE9mZnNldCB8fCAwO1xuICAgIHRoaXMucHJldmVudE5lZ2F0aXZlU2Nyb2xsT2Zmc2V0ID0gISFwcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQ7XG5cbiAgICBpZiAodHlwZW9mIG5vZGVIYW5kbGUgPT09ICdudW1iZXInKSB7XG4gICAgICBVSU1hbmFnZXIubWVhc3VyZUxheW91dChcbiAgICAgICAgbm9kZUhhbmRsZSxcbiAgICAgICAgUmVhY3ROYXRpdmUuZmluZE5vZGVIYW5kbGUodGhpcy5nZXRJbm5lclZpZXdOb2RlKCkpLFxuICAgICAgICB0aGlzLnNjcm9sbFJlc3BvbmRlclRleHRJbnB1dEZvY3VzRXJyb3IsXG4gICAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVySW5wdXRNZWFzdXJlQW5kU2Nyb2xsVG9LZXlib2FyZCxcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGlubmVyUmVmID0gdGhpcy5nZXRJbm5lclZpZXdSZWYoKTtcblxuICAgICAgaWYgKGlubmVyUmVmID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBub2RlSGFuZGxlLm1lYXN1cmVMYXlvdXQoXG4gICAgICAgIGlubmVyUmVmLFxuICAgICAgICB0aGlzLnNjcm9sbFJlc3BvbmRlcklucHV0TWVhc3VyZUFuZFNjcm9sbFRvS2V5Ym9hcmQsXG4gICAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyVGV4dElucHV0Rm9jdXNFcnJvcixcbiAgICAgICk7XG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiBUaGUgY2FsY3VsYXRpb25zIHBlcmZvcm1lZCBoZXJlIGFzc3VtZSB0aGUgc2Nyb2xsIHZpZXcgdGFrZXMgdXAgdGhlIGVudGlyZVxuICAgKiBzY3JlZW4gLSBldmVuIGlmIGhhcyBzb21lIGNvbnRlbnQgaW5zZXQuIFdlIHRoZW4gbWVhc3VyZSB0aGUgb2Zmc2V0cyBvZiB0aGVcbiAgICoga2V5Ym9hcmQsIGFuZCBjb21wZW5zYXRlIGJvdGggZm9yIHRoZSBzY3JvbGwgdmlldydzIFwiY29udGVudEluc2V0XCIuXG4gICAqXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBsZWZ0IFBvc2l0aW9uIG9mIGlucHV0IHcuci50LiB0YWJsZSB2aWV3LlxuICAgKiBAcGFyYW0ge251bWJlcn0gdG9wIFBvc2l0aW9uIG9mIGlucHV0IHcuci50LiB0YWJsZSB2aWV3LlxuICAgKiBAcGFyYW0ge251bWJlcn0gd2lkdGggV2lkdGggb2YgdGhlIHRleHQgaW5wdXQuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgSGVpZ2h0IG9mIHRoZSB0ZXh0IGlucHV0LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySW5wdXRNZWFzdXJlQW5kU2Nyb2xsVG9LZXlib2FyZDogZnVuY3Rpb24oXG4gICAgbGVmdDogbnVtYmVyLFxuICAgIHRvcDogbnVtYmVyLFxuICAgIHdpZHRoOiBudW1iZXIsXG4gICAgaGVpZ2h0OiBudW1iZXIsXG4gICkge1xuICAgIGxldCBrZXlib2FyZFNjcmVlblkgPSBEaW1lbnNpb25zLmdldCgnd2luZG93JykuaGVpZ2h0O1xuICAgIGlmICh0aGlzLmtleWJvYXJkV2lsbE9wZW5Ubykge1xuICAgICAga2V5Ym9hcmRTY3JlZW5ZID0gdGhpcy5rZXlib2FyZFdpbGxPcGVuVG8uZW5kQ29vcmRpbmF0ZXMuc2NyZWVuWTtcbiAgICB9XG4gICAgbGV0IHNjcm9sbE9mZnNldFkgPVxuICAgICAgdG9wIC0ga2V5Ym9hcmRTY3JlZW5ZICsgaGVpZ2h0ICsgdGhpcy5hZGRpdGlvbmFsU2Nyb2xsT2Zmc2V0O1xuXG4gICAgLy8gQnkgZGVmYXVsdCwgdGhpcyBjYW4gc2Nyb2xsIHdpdGggbmVnYXRpdmUgb2Zmc2V0LCBwdWxsaW5nIHRoZSBjb250ZW50XG4gICAgLy8gZG93biBzbyB0aGF0IHRoZSB0YXJnZXQgY29tcG9uZW50J3MgYm90dG9tIG1lZXRzIHRoZSBrZXlib2FyZCdzIHRvcC5cbiAgICAvLyBJZiByZXF1ZXN0ZWQgb3RoZXJ3aXNlLCBjYXAgdGhlIG9mZnNldCBhdCAwIG1pbmltdW0gdG8gYXZvaWQgY29udGVudFxuICAgIC8vIHNoaWZ0aW5nIGRvd24uXG4gICAgaWYgKHRoaXMucHJldmVudE5lZ2F0aXZlU2Nyb2xsT2Zmc2V0KSB7XG4gICAgICBzY3JvbGxPZmZzZXRZID0gTWF0aC5tYXgoMCwgc2Nyb2xsT2Zmc2V0WSk7XG4gICAgfVxuICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG8oe3g6IDAsIHk6IHNjcm9sbE9mZnNldFksIGFuaW1hdGVkOiB0cnVlfSk7XG5cbiAgICB0aGlzLmFkZGl0aW9uYWxPZmZzZXQgPSAwO1xuICAgIHRoaXMucHJldmVudE5lZ2F0aXZlU2Nyb2xsT2Zmc2V0ID0gZmFsc2U7XG4gIH0sXG5cbiAgc2Nyb2xsUmVzcG9uZGVyVGV4dElucHV0Rm9jdXNFcnJvcjogZnVuY3Rpb24obXNnOiBzdHJpbmcpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBtZWFzdXJpbmcgdGV4dCBmaWVsZDogJywgbXNnKTtcbiAgfSxcblxuICAvKipcbiAgICogYGNvbXBvbmVudFdpbGxNb3VudGAgaXMgdGhlIGNsb3Nlc3QgdGhpbmcgdG8gYSAgc3RhbmRhcmQgXCJjb25zdHJ1Y3RvclwiIGZvclxuICAgKiBSZWFjdCBjb21wb25lbnRzLlxuICAgKlxuICAgKiBUaGUgYGtleWJvYXJkV2lsbFNob3dgIGlzIGNhbGxlZCBiZWZvcmUgaW5wdXQgZm9jdXMuXG4gICAqL1xuICBVTlNBRkVfY29tcG9uZW50V2lsbE1vdW50OiBmdW5jdGlvbigpIHtcbiAgICBjb25zdCB7a2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwc30gPSAoKHRoaXM6IGFueSkucHJvcHM6IFNjcm9sbFZpZXdQcm9wcyk7XG4gICAgaWYgKHR5cGVvZiBrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzID09PSAnYm9vbGVhbicpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgYCdrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzPXske1xuICAgICAgICAgIGtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgPT09IHRydWUgPyAndHJ1ZScgOiAnZmFsc2UnXG4gICAgICAgIH19JyBpcyBkZXByZWNhdGVkLiBgICtcbiAgICAgICAgICBgVXNlICdrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzPVwiJHtcbiAgICAgICAgICAgIGtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgPyAnYWx3YXlzJyA6ICduZXZlcidcbiAgICAgICAgICB9XCInIGluc3RlYWRgLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAodGhpczogYW55KS5rZXlib2FyZFdpbGxPcGVuVG8gPSBudWxsO1xuICAgICh0aGlzOiBhbnkpLmFkZGl0aW9uYWxTY3JvbGxPZmZzZXQgPSAwO1xuICAgIHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbFNob3cgPSBLZXlib2FyZC5hZGRMaXN0ZW5lcihcbiAgICAgICdrZXlib2FyZFdpbGxTaG93JyxcbiAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmRXaWxsU2hvdyxcbiAgICApO1xuXG4gICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmRXaWxsSGlkZSA9IEtleWJvYXJkLmFkZExpc3RlbmVyKFxuICAgICAgJ2tleWJvYXJkV2lsbEhpZGUnLFxuICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJLZXlib2FyZFdpbGxIaWRlLFxuICAgICk7XG4gICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRTaG93ID0gS2V5Ym9hcmQuYWRkTGlzdGVuZXIoXG4gICAgICAna2V5Ym9hcmREaWRTaG93JyxcbiAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaWRTaG93LFxuICAgICk7XG4gICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRIaWRlID0gS2V5Ym9hcmQuYWRkTGlzdGVuZXIoXG4gICAgICAna2V5Ym9hcmREaWRIaWRlJyxcbiAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaWRIaWRlLFxuICAgICk7XG4gIH0sXG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQ6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxTaG93ICE9IG51bGwpIHtcbiAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbFNob3cucmVtb3ZlKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxIaWRlICE9IG51bGwpIHtcbiAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbEhpZGUucmVtb3ZlKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZERpZFNob3cgIT0gbnVsbCkge1xuICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRTaG93LnJlbW92ZSgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRIaWRlICE9IG51bGwpIHtcbiAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkSGlkZS5yZW1vdmUoKTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIFdhcm5pbmcsIHRoaXMgbWF5IGJlIGNhbGxlZCBzZXZlcmFsIHRpbWVzIGZvciBhIHNpbmdsZSBrZXlib2FyZCBvcGVuaW5nLlxuICAgKiBJdCdzIGJlc3QgdG8gc3RvcmUgdGhlIGluZm9ybWF0aW9uIGluIHRoaXMgbWV0aG9kIGFuZCB0aGVuIHRha2UgYW55IGFjdGlvblxuICAgKiBhdCBhIGxhdGVyIHBvaW50IChlaXRoZXIgaW4gYGtleWJvYXJkRGlkU2hvd2Agb3Igb3RoZXIpLlxuICAgKlxuICAgKiBIZXJlJ3MgdGhlIG9yZGVyIHRoYXQgZXZlbnRzIG9jY3VyIGluOlxuICAgKiAtIGZvY3VzXG4gICAqIC0gd2lsbFNob3cge3N0YXJ0Q29vcmRpbmF0ZXMsIGVuZENvb3JkaW5hdGVzfSBzZXZlcmFsIHRpbWVzXG4gICAqIC0gZGlkU2hvdyBzZXZlcmFsIHRpbWVzXG4gICAqIC0gYmx1clxuICAgKiAtIHdpbGxIaWRlIHtzdGFydENvb3JkaW5hdGVzLCBlbmRDb29yZGluYXRlc30gc2V2ZXJhbCB0aW1lc1xuICAgKiAtIGRpZEhpZGUgc2V2ZXJhbCB0aW1lc1xuICAgKlxuICAgKiBUaGUgYFNjcm9sbFJlc3BvbmRlcmAgbW9kdWxlIGNhbGxiYWNrcyBmb3IgZWFjaCBvZiB0aGVzZSBldmVudHMuXG4gICAqIEV2ZW4gdGhvdWdoIGFueSB1c2VyIGNvdWxkIGhhdmUgZWFzaWx5IGxpc3RlbmVkIHRvIGtleWJvYXJkIGV2ZW50c1xuICAgKiB0aGVtc2VsdmVzLCB1c2luZyB0aGVzZSBgcHJvcHNgIGNhbGxiYWNrcyBlbnN1cmVzIHRoYXQgb3JkZXJpbmcgb2YgZXZlbnRzXG4gICAqIGlzIGNvbnNpc3RlbnQgLSBhbmQgbm90IGRlcGVuZGVudCBvbiB0aGUgb3JkZXIgdGhhdCB0aGUga2V5Ym9hcmQgZXZlbnRzIGFyZVxuICAgKiBzdWJzY3JpYmVkIHRvLiBUaGlzIG1hdHRlcnMgd2hlbiB0ZWxsaW5nIHRoZSBzY3JvbGwgdmlldyB0byBzY3JvbGwgdG8gd2hlcmVcbiAgICogdGhlIGtleWJvYXJkIGlzIGhlYWRlZCAtIHRoZSBzY3JvbGwgcmVzcG9uZGVyIGJldHRlciBoYXZlIGJlZW4gbm90aWZpZWQgb2ZcbiAgICogdGhlIGtleWJvYXJkIGRlc3RpbmF0aW9uIGJlZm9yZSBiZWluZyBpbnN0cnVjdGVkIHRvIHNjcm9sbCB0byB3aGVyZSB0aGVcbiAgICoga2V5Ym9hcmQgd2lsbCBiZS4gU3RpY2sgdG8gdGhlIGBTY3JvbGxSZXNwb25kZXJgIGNhbGxiYWNrcywgYW5kIGV2ZXJ5dGhpbmdcbiAgICogd2lsbCB3b3JrLlxuICAgKlxuICAgKiBXQVJOSU5HOiBUaGVzZSBjYWxsYmFja3Mgd2lsbCBmaXJlIGV2ZW4gaWYgYSBrZXlib2FyZCBpcyBkaXNwbGF5ZWQgaW4gYVxuICAgKiBkaWZmZXJlbnQgbmF2aWdhdGlvbiBwYW5lLiBGaWx0ZXIgb3V0IHRoZSBldmVudHMgdG8gZGV0ZXJtaW5lIGlmIHRoZXkgYXJlXG4gICAqIHJlbGV2YW50IHRvIHlvdS4gKEZvciBleGFtcGxlLCBvbmx5IGlmIHlvdSByZWNlaXZlIHRoZXNlIGNhbGxiYWNrcyBhZnRlclxuICAgKiB5b3UgaGFkIGV4cGxpY2l0bHkgZm9jdXNlZCBhIG5vZGUgZXRjKS5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlcktleWJvYXJkV2lsbFNob3c6IGZ1bmN0aW9uKGU6IEtleWJvYXJkRXZlbnQpIHtcbiAgICB0aGlzLmtleWJvYXJkV2lsbE9wZW5UbyA9IGU7XG4gICAgdGhpcy5wcm9wcy5vbktleWJvYXJkV2lsbFNob3cgJiYgdGhpcy5wcm9wcy5vbktleWJvYXJkV2lsbFNob3coZSk7XG4gIH0sXG5cbiAgc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmRXaWxsSGlkZTogZnVuY3Rpb24oZTogS2V5Ym9hcmRFdmVudCkge1xuICAgIHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvID0gbnVsbDtcbiAgICB0aGlzLnByb3BzLm9uS2V5Ym9hcmRXaWxsSGlkZSAmJiB0aGlzLnByb3BzLm9uS2V5Ym9hcmRXaWxsSGlkZShlKTtcbiAgfSxcblxuICBzY3JvbGxSZXNwb25kZXJLZXlib2FyZERpZFNob3c6IGZ1bmN0aW9uKGU6IEtleWJvYXJkRXZlbnQpIHtcbiAgICAvLyBUT0RPKDc2OTM5NjEpOiBUaGUgZXZlbnQgZm9yIERpZFNob3cgaXMgbm90IGF2YWlsYWJsZSBvbiBpT1MgeWV0LlxuICAgIC8vIFVzZSB0aGUgb25lIGZyb20gV2lsbFNob3cgYW5kIGRvIG5vdCBhc3NpZ24uXG4gICAgaWYgKGUpIHtcbiAgICAgIHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvID0gZTtcbiAgICB9XG4gICAgdGhpcy5wcm9wcy5vbktleWJvYXJkRGlkU2hvdyAmJiB0aGlzLnByb3BzLm9uS2V5Ym9hcmREaWRTaG93KGUpO1xuICB9LFxuXG4gIHNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlkSGlkZTogZnVuY3Rpb24oZTogS2V5Ym9hcmRFdmVudCkge1xuICAgIHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvID0gbnVsbDtcbiAgICB0aGlzLnByb3BzLm9uS2V5Ym9hcmREaWRIaWRlICYmIHRoaXMucHJvcHMub25LZXlib2FyZERpZEhpZGUoZSk7XG4gIH0sXG59O1xuXG5jb25zdCBTY3JvbGxSZXNwb25kZXIgPSB7XG4gIE1peGluOiBTY3JvbGxSZXNwb25kZXJNaXhpbixcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU2Nyb2xsUmVzcG9uZGVyO1xuIl19